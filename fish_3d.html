
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>fish_3d package &#8212; FishPy  documentation</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="fish_corr package" href="fish_corr.html" />
    <link rel="prev" title="FishPy" href="modules.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>FishPy  documentation</span></a></h1>
        <h2 class="heading"><span>fish_3d package</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="modules.html">FishPy</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="fish_corr.html">fish_corr package</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <div class="section" id="fish-3d-package">
<h1>fish_3d package<a class="headerlink" href="#fish-3d-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-fish_3d.camera">
<span id="fish-3d-camera-module"></span><h2>fish_3d.camera module<a class="headerlink" href="#module-fish_3d.camera" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="fish_3d.camera.Camera">
<em class="property">class </em><code class="sig-prename descclassname">fish_3d.camera.</code><code class="sig-name descname">Camera</code><a class="headerlink" href="#fish_3d.camera.Camera" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This class holds intrinsic/extrinsic parameters of a camera, with some handy functions</p>
<dl class="py attribute">
<dt id="fish_3d.camera.Camera.self.r">
<code class="sig-prename descclassname">self.</code><code class="sig-name descname">r</code><a class="headerlink" href="#fish_3d.camera.Camera.self.r" title="Permalink to this definition">¶</a></dt>
<dd><p>rotation matrix of the camera, shape (3, 3)</p>
</dd></dl>

<dl class="py attribute">
<dt id="fish_3d.camera.Camera.self.ext">
<code class="sig-prename descclassname">self.</code><code class="sig-name descname">ext</code><a class="headerlink" href="#fish_3d.camera.Camera.self.ext" title="Permalink to this definition">¶</a></dt>
<dd><p>extrinsic parameters, # R, t –&gt; [R|t]</p>
</dd></dl>

<dl class="py attribute">
<dt id="fish_3d.camera.Camera.self.p">
<code class="sig-prename descclassname">self.</code><code class="sig-name descname">p</code><a class="headerlink" href="#fish_3d.camera.Camera.self.p" title="Permalink to this definition">¶</a></dt>
<dd><p>projection matrix int &#64; ext</p>
</dd></dl>

<dl class="py attribute">
<dt id="fish_3d.camera.Camera.self.o">
<code class="sig-prename descclassname">self.</code><code class="sig-name descname">o</code><a class="headerlink" href="#fish_3d.camera.Camera.self.o" title="Permalink to this definition">¶</a></dt>
<dd><p>origin of the camera, shape (3, 1)</p>
</dd></dl>

<dl class="py method">
<dt id="fish_3d.camera.Camera.calibrate">
<code class="sig-name descname">calibrate</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">int_images</span><span class="p">:</span> <span class="n">list</span></em>, <em class="sig-param"><span class="n">ext_image</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">grid_size</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">order</span><span class="o">=</span><span class="default_value">'x123'</span></em>, <em class="sig-param"><span class="n">corner_number</span><span class="o">=</span><span class="default_value">6, 6</span></em>, <em class="sig-param"><span class="n">win_size</span><span class="o">=</span><span class="default_value">5, 5</span></em>, <em class="sig-param"><span class="n">show</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.calibrate" title="Permalink to this definition">¶</a></dt>
<dd><p>update intrinsic and extrinsic camera matrix using opencv’s chessboard detector
the distortion coefficients are also being detected
the corner number should be in the format of (row, column)</p>
</dd></dl>

<dl class="py method">
<dt id="fish_3d.camera.Camera.calibrate_ext">
<code class="sig-name descname">calibrate_ext</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ext_image</span><span class="p">:</span> <span class="n">str</span></em>, <em class="sig-param"><span class="n">grid_size</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">order</span><span class="o">=</span><span class="default_value">'x123'</span></em>, <em class="sig-param"><span class="n">corner_number</span><span class="o">=</span><span class="default_value">6, 6</span></em>, <em class="sig-param"><span class="n">win_size</span><span class="o">=</span><span class="default_value">5, 5</span></em>, <em class="sig-param"><span class="n">show</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.calibrate_ext" title="Permalink to this definition">¶</a></dt>
<dd><p>update EXTRINSIC camera matrix using opencv’s chessboard detector
the distortion coefficients are also being detected
the corner number should be in the format of (row, column)</p>
</dd></dl>

<dl class="py method">
<dt id="fish_3d.camera.Camera.calibrate_int">
<code class="sig-name descname">calibrate_int</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">int_images</span><span class="p">:</span> <span class="n">list</span></em>, <em class="sig-param"><span class="n">grid_size</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">corner_number</span><span class="o">=</span><span class="default_value">6, 6</span></em>, <em class="sig-param"><span class="n">win_size</span><span class="o">=</span><span class="default_value">5, 5</span></em>, <em class="sig-param"><span class="n">show</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.calibrate_int" title="Permalink to this definition">¶</a></dt>
<dd><p>update INTERINSIC camera matrix using opencv’s chessboard detector
the distortion coefficients are also being detected
the corner number should be in the format of (row, column)</p>
</dd></dl>

<dl class="py method">
<dt id="fish_3d.camera.Camera.project">
<code class="sig-name descname">project</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">position</span><span class="p">:</span> <span class="n">numpy.array</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.project" title="Permalink to this definition">¶</a></dt>
<dd><p>Project a 3D position onto the image plane</p>
</dd></dl>

<dl class="py method">
<dt id="fish_3d.camera.Camera.read_calibration">
<code class="sig-name descname">read_calibration</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">mat_file</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.read_calibration" title="Permalink to this definition">¶</a></dt>
<dd><p>Read calibration result from TOOLBOX_calib
The calibration result is generated by following Matlab script:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;fc&#39;</span><span class="p">,</span> <span class="s">&#39;cc&#39;</span><span class="p">,</span> <span class="s">&#39;Tc_ext&#39;</span><span class="p">,</span> <span class="s">&#39;Rc_ext&#39;</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="fish_3d.camera.Camera.read_int">
<code class="sig-name descname">read_int</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pkl_file</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.read_int" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="fish_3d.camera.Camera.redistort_points">
<code class="sig-name descname">redistort_points</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">points</span><span class="p">:</span> <span class="n">numpy.array</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.redistort_points" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>points</strong> (<em>np.ndarray</em>) – undistorted image coordinates (u, v) in pixels, shape (2, n)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the distorted points</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="fish_3d.camera.Camera.undistort">
<code class="sig-name descname">undistort</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">point</span><span class="p">:</span> <span class="n">numpy.array</span></em>, <em class="sig-param"><span class="n">want_uv</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.undistort" title="Permalink to this definition">¶</a></dt>
<dd><p>undistort point in an image, coordinate is (u, v)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>point</strong> (<em>np.ndarray</em>) – the points to be undistorted</p></li>
<li><p><strong>want_uv</strong> (<em>bool</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>undistorted points, being xy, not uv (camera.K &#64; xy = uv)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="fish_3d.camera.Camera.undistort_image">
<code class="sig-name descname">undistort_image</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span><span class="p">:</span> <span class="n">numpy.array</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.undistort_image" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> (<em>np.ndarray</em>) – an image taken by the camera</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a undistorted 2D image</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="fish_3d.camera.Camera.undistort_points">
<code class="sig-name descname">undistort_points</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">points</span><span class="p">:</span> <span class="n">numpy.array</span></em>, <em class="sig-param"><span class="n">want_uv</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.undistort_points" title="Permalink to this definition">¶</a></dt>
<dd><p>Undistort many points in an image, coordinate is (u, v), NOT (x, y)</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>undistorted version of (x’, y’) or (u’, v’), shape (n, 2)</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>np.ndarray</p>
</dd>
</dl>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">&#39;</span> <span class="o">*</span> <span class="n">fx</span> <span class="o">+</span> <span class="n">cx</span> <span class="o">-&gt;</span> <span class="n">u</span><span class="o">&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt id="fish_3d.camera.Camera.update">
<code class="sig-name descname">update</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.update" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt id="fish_3d.camera.calib_mult_ext">
<code class="sig-prename descclassname">fish_3d.camera.</code><code class="sig-name descname">calib_mult_ext</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cam_1</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera">fish_3d.camera.Camera</a></span></em>, <em class="sig-param"><span class="n">cam_2</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera">fish_3d.camera.Camera</a></span></em>, <em class="sig-param"><span class="n">cam_3</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera">fish_3d.camera.Camera</a></span></em>, <em class="sig-param"><span class="n">images_v1</span><span class="p">:</span> <span class="n">List<span class="p">[</span>str<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">images_v2</span><span class="p">:</span> <span class="n">List<span class="p">[</span>str<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">images_v3</span><span class="p">:</span> <span class="n">List<span class="p">[</span>str<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">orders_v1</span><span class="p">:</span> <span class="n">List<span class="p">[</span>str<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">orders_v2</span><span class="p">:</span> <span class="n">List<span class="p">[</span>str<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">orders_v3</span><span class="p">:</span> <span class="n">List<span class="p">[</span>str<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">grid_size</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">corner_number</span><span class="p">:</span> <span class="n">Tuple<span class="p">[</span>int<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">win_size</span><span class="o">=</span><span class="default_value">10, 10</span></em><span class="sig-paren">)</span> &#x2192; None<a class="headerlink" href="#fish_3d.camera.calib_mult_ext" title="Permalink to this definition">¶</a></dt>
<dd><p>Do extrinsic calibrations multiple times, calculate average <em>relative displacement &amp; angle</em>
Then use the last calibration image as world coordinate</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cam_1</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – The internal parameters should be correct</p></li>
<li><p><strong>cam_2</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – The internal parameters should be correct</p></li>
<li><p><strong>cam_3</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – The internal parameters should be correct</p></li>
<li><p><strong>images_v1</strong> (<em>list</em>) – calibrations image filenames for camera 1</p></li>
<li><p><strong>images_v2</strong> (<em>list</em>) – calibrations image filenames for camera 2</p></li>
<li><p><strong>images_v3</strong> (<em>list</em>) – calibrations image filenames for camera 3</p></li>
<li><p><strong>orders_v1</strong> (<em>list</em>) – The order of ‘x123’ or ‘321x’ for each calibration imags for camera 1</p></li>
<li><p><strong>orders_v2</strong> (<em>list</em>) – The order of ‘x123’ or ‘321x’ for each calibration imags for camera 2</p></li>
<li><p><strong>orders_v3</strong> (<em>list</em>) – The order of ‘x123’ or ‘321x’ for each calibration imags for camera 3</p></li>
<li><p><strong>grid_size</strong> (<em>float</em>) – size of a single grid in chessboard, only support square grids</p></li>
<li><p><strong>corner_number</strong> (<em>tuple</em>) – (horizontal, vertical), specifying the number of corners in each direction
corner_number = grid_number - 1</p></li>
<li><p><strong>win_size</strong> (<em>tuple</em>) – Search parameter in the opencv</p></li>
</ul>
</dd>
</dl>
<p>Equations (&#64; is dot product)</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">x1</span> <span class="p">=</span> <span class="n">r1</span>  <span class="p">@</span> <span class="n">xw</span> <span class="o">+</span> <span class="n">t1</span>   <span class="p">(</span><span class="n">world</span> <span class="n">to</span> <span class="n">camera</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r1</span> <span class="o">&amp;</span> <span class="n">t1</span> <span class="n">obtained</span> <span class="n">from</span> <span class="n">Camera</span><span class="p">.</span><span class="n">calibrate_ext</span><span class="p">)</span>
<span class="n">x2</span> <span class="p">=</span> <span class="n">r2</span>  <span class="p">@</span> <span class="n">xw</span> <span class="o">+</span> <span class="n">t2</span>   <span class="p">(</span><span class="n">world</span> <span class="n">to</span> <span class="n">camera</span> <span class="mi">2</span><span class="p">,</span> <span class="n">r2</span> <span class="o">&amp;</span> <span class="n">t2</span> <span class="n">obtained</span> <span class="n">from</span> <span class="n">Camera</span><span class="p">.</span><span class="n">calibrate_ext</span><span class="p">)</span>
<span class="n">x2</span> <span class="p">=</span> <span class="n">r12</span> <span class="p">@</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">t12</span>  <span class="p">(</span><span class="n">camera</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">camera</span> <span class="mi">2</span><span class="p">)</span>
<span class="o">--&gt;</span> <span class="n">r12</span> <span class="p">=</span> <span class="n">r2</span> <span class="p">@</span> <span class="n">r1</span><span class="o">&#39;</span>
<span class="o">--&gt;</span> <span class="n">t12</span> <span class="p">=</span> <span class="n">t2</span> <span class="o">-</span> <span class="n">r2</span> <span class="p">@</span> <span class="n">r1</span><span class="o">&#39;</span> <span class="p">@</span> <span class="n">t1</span>
<span class="o">--&gt;</span> <span class="n">t2</span>  <span class="p">=</span> <span class="n">t12</span> <span class="o">+</span> <span class="n">r12</span> <span class="p">@</span> <span class="n">t1</span>
<span class="o">--&gt;</span> <span class="n">r2</span>  <span class="p">=</span> <span class="n">r12</span> <span class="p">@</span> <span class="n">r1</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.camera.draw">
<code class="sig-prename descclassname">fish_3d.camera.</code><code class="sig-name descname">draw</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">img</span></em>, <em class="sig-param"><span class="n">axes</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.draw" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.camera.find_pairs">
<code class="sig-prename descclassname">fish_3d.camera.</code><code class="sig-name descname">find_pairs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">arr_1</span></em>, <em class="sig-param"><span class="n">arr_2</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.find_pairs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.camera.get_fundamental">
<code class="sig-prename descclassname">fish_3d.camera.</code><code class="sig-name descname">get_fundamental</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cam_1</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera">fish_3d.camera.Camera</a></span></em>, <em class="sig-param"><span class="n">cam_2</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera">fish_3d.camera.Camera</a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.get_fundamental" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the fundamental matrix between two cameras</p>
<p>In the actually calculation, rotate axes of camera 2, so that external of camera 1 is <code class="docutils literal notranslate"><span class="pre">[E|0]</span></code></p>
<p>(ref: <a class="reference external" href="https://sourishghosh.com/2016/fundamental-matrix-from-camera-matrices/">https://sourishghosh.com/2016/fundamental-matrix-from-camera-matrices/</a>)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cam_1</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – Camera instance  whose P, K, R, t, C are all known</p></li>
<li><p><strong>cam_2</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – Camera instance  whose P, K, R, t, C are all known</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>the fundamental matrix F, where</dt><dd><ol class="arabic simple">
<li><p>x2.T &#64; F &#64; x1 = 0</p></li>
<li><p>F &#64; x1 = l2  (epipolar line)</p></li>
</ol>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.camera.get_points_from_order">
<code class="sig-prename descclassname">fish_3d.camera.</code><code class="sig-name descname">get_points_from_order</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">corner_number</span></em>, <em class="sig-param"><span class="n">order</span><span class="o">=</span><span class="default_value">'x123'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.get_points_from_order" title="Permalink to this definition">¶</a></dt>
<dd><p>the expected calibration image is</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span>┌───────┬───────┬───────┐
│  ╲ ╱  │◜◜◜◜◜◜◜│   ╮   │
│   ╳   │◜◜◜◜◜◜◜│   │   │
│  ╱ ╲  │◜◜◜◜◜◜◜│   ┴   │
├───────┼───────┼───────┤
│◜◜◜◜◜◜◜│       │◜◜◜◜◜◜◜│
│◜◜◜◜◜◜◜│       │◜◜◜◜◜◜◜│
│◜◜◜◜◜◜◜│       │◜◜◜◜◜◜◜│
├───────┼───────┼───────┤
│  ╶─╮  │◜◜◜◜◜◜◜│   ──┐ │
│  ╭─╯  │◜◜◜◜◜◜◜│   ╶─┤ │
│  ╰──  │◜◜◜◜◜◜◜│   ──┘ │
└───────┴───────┴───────┘
</pre></div>
</div>
<p>and the corresponding order is x123 (row, colume)</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.camera.get_reproject_error">
<code class="sig-prename descclassname">fish_3d.camera.</code><code class="sig-name descname">get_reproject_error</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">points_2d</span></em>, <em class="sig-param"><span class="n">points_3d</span></em>, <em class="sig-param"><span class="n">rvec</span></em>, <em class="sig-param"><span class="n">tvec</span></em>, <em class="sig-param"><span class="n">distort</span></em>, <em class="sig-param"><span class="n">camera_matrix</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.get_reproject_error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.camera.plot_cameras">
<code class="sig-prename descclassname">fish_3d.camera.</code><code class="sig-name descname">plot_cameras</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">axis</span></em>, <em class="sig-param"><span class="n">cameras</span></em>, <em class="sig-param"><span class="n">water_level</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">depth</span><span class="o">=</span><span class="default_value">400</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.plot_cameras" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-fish_3d.cray_trace">
<span id="fish-3d-cray-trace-module"></span><h2>fish_3d.cray_trace module<a class="headerlink" href="#module-fish_3d.cray_trace" title="Permalink to this headline">¶</a></h2>
<p>refractive ray tracing</p>
<dl class="py function">
<dt id="fish_3d.cray_trace.get_intersect_multiple">
<code class="sig-prename descclassname">fish_3d.cray_trace.</code><code class="sig-name descname">get_intersect_multiple</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">lines</span><span class="p">:</span> <span class="n">numpy.ndarray[float64[m, 18], flags.c_contiguous]</span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray[float64[m, 3]]<a class="headerlink" href="#fish_3d.cray_trace.get_intersect_multiple" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the points that are closest to a collection of multiple lines</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.cray_trace.get_intersect_of_lines">
<code class="sig-prename descclassname">fish_3d.cray_trace.</code><code class="sig-name descname">get_intersect_of_lines</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">lines</span><span class="p">:</span> <span class="n">numpy.ndarray<span class="p">[</span>float64<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<span class="p">[</span>float64<span class="p">]</span><a class="headerlink" href="#fish_3d.cray_trace.get_intersect_of_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the point that are closest to multiple lines</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.cray_trace.get_intersect_single">
<code class="sig-prename descclassname">fish_3d.cray_trace.</code><code class="sig-name descname">get_intersect_single</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">lines</span><span class="p">:</span> <span class="n">numpy.ndarray[float64[3, 6], flags.c_contiguous]</span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray[float64[1, 3]]<a class="headerlink" href="#fish_3d.cray_trace.get_intersect_single" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the point that is closest to multiple lines</p>
</dd></dl>

</div>
<div class="section" id="module-fish_3d.ellipse">
<span id="fish-3d-ellipse-module"></span><h2>fish_3d.ellipse module<a class="headerlink" href="#module-fish_3d.ellipse" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="fish_3d.ellipse.draw_ellipse">
<code class="sig-prename descclassname">fish_3d.ellipse.</code><code class="sig-name descname">draw_ellipse</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">angle</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">ellipse</span><span class="p">:</span> <span class="n">List<span class="p">[</span>float<span class="p">]</span></span></em><span class="sig-paren">)</span> &#x2192; numpy.ndarray<a class="headerlink" href="#fish_3d.ellipse.draw_ellipse" title="Permalink to this definition">¶</a></dt>
<dd><p>return (u, v) coordinates for plotting
no need to use <cite>np.flip</cite> to plot with figure</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ellipse.find_projection">
<code class="sig-prename descclassname">fish_3d.ellipse.</code><code class="sig-name descname">find_projection</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ellipse</span></em>, <em class="sig-param"><span class="n">line</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ellipse.find_projection" title="Permalink to this definition">¶</a></dt>
<dd><p>find the point on an ellipse that is closest to a line
:param ellipse: represented as (al, bl, xc, yc, rot), the geometrical form
:param line:    represented as (a1, a2, a3) where l1 x + l2 y + l3 == 0
I am sorry for the inconsistent notations</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ellipse.get_conic_coef">
<code class="sig-prename descclassname">fish_3d.ellipse.</code><code class="sig-name descname">get_conic_coef</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">a</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">b</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">xc</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">yc</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">rotation</span><span class="p">:</span> <span class="n">float</span></em><span class="sig-paren">)</span> &#x2192; Tuple<span class="p">[</span>float<span class="p">]</span><a class="headerlink" href="#fish_3d.ellipse.get_conic_coef" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent an ellipse from geometric form (a, b, x_centre, y_centre, rotation)
to the algebraic form (α x^2 + β x y + γ y^2 + δ x + ε y + η)</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ellipse.get_intersection">
<code class="sig-prename descclassname">fish_3d.ellipse.</code><code class="sig-name descname">get_intersection</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ellipse</span></em>, <em class="sig-param"><span class="n">line</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ellipse.get_intersection" title="Permalink to this definition">¶</a></dt>
<dd><p>find the intersection between an ellipse and a line
:param ellipse: represented as (a, b, xc, yc, rot), the geometrical form
:param line:    represented as (l1, l2, l3) where l1 x + l2 y + l3 == 0
* If there is no intersection, then find the point on the ellipse that is closest to the line.</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ellipse.match_ellipse_sloopy">
<code class="sig-prename descclassname">fish_3d.ellipse.</code><code class="sig-name descname">match_ellipse_sloopy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cameras</span><span class="p">:</span> <span class="n">List<span class="p">[</span>Camera<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">ellipses</span><span class="p">:</span> <span class="n">List<span class="p">[</span>List<span class="p">[</span>float<span class="p">]</span><span class="p">]</span></span></em>, <em class="sig-param"><span class="n">N</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">min_diff</span><span class="o">=</span><span class="default_value">250</span></em>, <em class="sig-param"><span class="n">max_cost</span><span class="o">=</span><span class="default_value">10</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ellipse.match_ellipse_sloopy" title="Permalink to this definition">¶</a></dt>
<dd><p>1. Randomly choose N points in view 1
3. For every chosen point (P1)</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Calculate POI of P1 in other two views, get POI2 &amp; POI3</p></li>
<li><p>For POI2, calculate its projection on C2, get P2 (using camera’s information)</p></li>
<li><p>For POI3, calculate its projection on C3, get P3</p></li>
<li><p>Reconstruct 3D point using P1, P2, &amp; P3</p></li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="4">
<li><p>These points should be points on the surface</p></li>
</ol>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ellipse.parse_ellipses_imagej">
<code class="sig-prename descclassname">fish_3d.ellipse.</code><code class="sig-name descname">parse_ellipses_imagej</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">csv_file</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ellipse.parse_ellipses_imagej" title="Permalink to this definition">¶</a></dt>
<dd><p>the ellipse expression corresponds to (u, v) coordinate system</p>
</dd></dl>

</div>
<div class="section" id="module-fish_3d.ray_trace">
<span id="fish-3d-ray-trace-module"></span><h2>fish_3d.ray_trace module<a class="headerlink" href="#module-fish_3d.ray_trace" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="fish_3d.ray_trace.cost_snell">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">cost_snell</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xy</span></em>, <em class="sig-param"><span class="n">z</span></em>, <em class="sig-param"><span class="n">location</span></em>, <em class="sig-param"><span class="n">origin</span></em>, <em class="sig-param"><span class="n">normal</span></em>, <em class="sig-param"><span class="n">refractive_index</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.cost_snell" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.epipolar_draw">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">epipolar_draw</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">uv</span></em>, <em class="sig-param"><span class="n">camera_1</span></em>, <em class="sig-param"><span class="n">camera_2</span></em>, <em class="sig-param"><span class="n">image_2</span></em>, <em class="sig-param"><span class="n">interface</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">depth</span><span class="o">=</span><span class="default_value">400</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em>, <em class="sig-param"><span class="n">n</span><span class="o">=</span><span class="default_value">1.33</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.epipolar_draw" title="Permalink to this definition">¶</a></dt>
<dd><p>return all the pixels that contains the epipolar line in image_2, re-projected &amp; distorted</p>
<p>The meanings of variable names can be found in this paper</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>uv</strong> – (u, v) location of a pixel on image from camera_1</p></li>
<li><p><strong>interface</strong> – height of water level in WORLD coordinate system</p></li>
<li><p><strong>normal</strong> – normal of the air-water interface, from water to air</p></li>
<li><p><strong>n</strong> – refractive index of water (or some other media)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.epipolar_la">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">epipolar_la</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">uv</span></em>, <em class="sig-param"><span class="n">camera_1</span></em>, <em class="sig-param"><span class="n">camera_2</span></em>, <em class="sig-param"><span class="n">interface</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">depth</span><span class="o">=</span><span class="default_value">400</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em>, <em class="sig-param"><span class="n">n</span><span class="o">=</span><span class="default_value">1.33</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.epipolar_la" title="Permalink to this definition">¶</a></dt>
<dd><p>linear approximation for epipolar line under water
the line path through two UNDISTORTED projection points, one at the interface one below water
use 5 epipolar points under water and do a linear fit</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.epipolar_la_draw">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">epipolar_la_draw</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">uv</span></em>, <em class="sig-param"><span class="n">camera_1</span></em>, <em class="sig-param"><span class="n">camera_2</span></em>, <em class="sig-param"><span class="n">image_2</span></em>, <em class="sig-param"><span class="n">interface</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">depth</span><span class="o">=</span><span class="default_value">400</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em>, <em class="sig-param"><span class="n">n</span><span class="o">=</span><span class="default_value">1.33</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.epipolar_la_draw" title="Permalink to this definition">¶</a></dt>
<dd><p>linear approximation for epipolar line under water
use 3 epipolar points under water and do a linear fit</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.epipolar_refractive">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">epipolar_refractive</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">uv</span></em>, <em class="sig-param"><span class="n">camera_1</span></em>, <em class="sig-param"><span class="n">camera_2</span></em>, <em class="sig-param"><span class="n">image_2</span></em>, <em class="sig-param"><span class="n">interface</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em>, <em class="sig-param"><span class="n">step</span><span class="o">=</span><span class="default_value">1</span></em>, <em class="sig-param"><span class="n">n</span><span class="o">=</span><span class="default_value">1.33</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.epipolar_refractive" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>The meanings of variable names can be found in this paper</dt><dd><p>10.1109/CRV.2011.26</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>uv</strong> – (u, v) location of a pixel on image from camera_1, NOT (x, y)</p></li>
<li><p><strong>interface</strong> – height of water level in WORLD coordinate system</p></li>
<li><p><strong>normal</strong> – normal of the air-water interface, from water to air</p></li>
<li><p><strong>n</strong> – refractive index of water (or some other media)</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Here the goal is:</dt><dd><ol class="arabic simple">
<li><p>For given pixel (u, v) in image taken by camera #1, calculated
it’s projection on air-water interface (poi_1), and the
direction of the refractted ray (trans_vec)</p></li>
<li><dl class="simple">
<dt>While the projection is still on image from camera_2:</dt><dd><ol class="lowerroman simple">
<li><p>Calculated the position (M) from poi_1 going along trans_vec</p></li>
<li><p>Project M onto camera #2</p></li>
<li><p>Collect the projection points</p></li>
</ol>
</dd>
</dl>
</li>
</ol>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.find_u">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">find_u</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">u</span></em>, <em class="sig-param"><span class="n">n</span></em>, <em class="sig-param"><span class="n">d</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">z</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.find_u" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>The meanings of variable names can be found in this paper</dt><dd><p>10.1109/CRV.2011.26</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.get_intersect_of_lines">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">get_intersect_of_lines</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">lines</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_intersect_of_lines" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>lines</strong> (<em>np.ndarray</em>) – a collection of different lines, …], shape -&gt; (n, 2, 3)
line = [points (a), unit directions (v)]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.get_intersect_of_lines_slow">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">get_intersect_of_lines_slow</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">lines</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_intersect_of_lines_slow" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate intersecting point of many lines</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<em>list</em>) – a list containing many lines</p></li>
<li><p><strong>line</strong> (<em>dict</em>) – a dict containing the unit vector and a base point</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the a point in 3D whose distances sum to all lines is minimum</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
<p>(I followed this answer: <a class="reference external" href="https://stackoverflow.com/a/48201730/4116538">https://stackoverflow.com/a/48201730/4116538</a>)</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.get_poi">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">get_poi</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">camera</span><span class="p">:</span> <span class="n">Camera</span></em>, <em class="sig-param"><span class="n">z</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">coordinate</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_poi" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the poi, point on interface. See the sketch for its meaning</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>               <span class="n">camera</span>
              <span class="o">/</span>
             <span class="o">/</span>
            <span class="o">/</span>
<span class="o">---------</span><span class="p">[</span><span class="n">poi</span><span class="p">]</span><span class="o">--------</span> <span class="n">air</span><span class="o">-</span><span class="n">water</span> <span class="n">interface</span> <span class="p">(</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">)</span>
           <span class="o">|</span>
           <span class="o">|</span>
           <span class="o">|</span>
         <span class="n">fish</span>
</pre></div>
</div>
<p>For the calculation, the equation: P &#64; [x, y, z, 1]’ = [c * v, c * u, c]’ are solved
for x, y, c knowing everything else</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>camera</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – a Camera instance</p></li>
<li><p><strong>z</strong> (<em>float</em>) – the hight of water level with respect to world origin</p></li>
<li><p><strong>corrdinate</strong> (<em>np.ndarray</em>) – the position (u, v) of object on the image, unit is pixel</p></li>
<li><p><strong>can be one point</strong><strong> or </strong><strong>many points</strong><strong>, </strong><strong>but they should be undistorted</strong> (<em>it</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the points on interface, [X, Y, Z], shape (3, n)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.get_poi_cluster">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">get_poi_cluster</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">camera</span></em>, <em class="sig-param"><span class="n">z</span></em>, <em class="sig-param"><span class="n">coordinate</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_poi_cluster" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.get_reproj_err">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">get_reproj_err</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">point_3d</span></em>, <em class="sig-param"><span class="n">points_2d</span></em>, <em class="sig-param"><span class="n">cameras</span></em>, <em class="sig-param"><span class="n">water_level</span></em>, <em class="sig-param"><span class="n">normal</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_reproj_err" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.get_trans_vec">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">get_trans_vec</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">incident_vec</span></em>, <em class="sig-param"><span class="n">refractive_index</span><span class="o">=</span><span class="default_value">1.33</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_trans_vec" title="Permalink to this definition">¶</a></dt>
<dd><p>get the unit vector of transmitted ray from air to water</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>incident_vec</strong> (<em>np.ndarray</em>) – the vector representing the incident ray</p></li>
<li><p><strong>refractive_index</strong> (<em>float</em>) – the refractive index of water is 1.33 &#64; 25°C</p></li>
<li><p><strong>normal</strong> (<em>np.ndarray</em>) – the normal vector facing up, the coordinate is looks like</p></li>
</ul>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="o">^</span> <span class="o">+</span><span class="n">z</span>
<span class="n">air</span>     <span class="o">|</span>
        <span class="o">|</span>
<span class="o">------------------&gt;</span>
        <span class="o">|</span>
<span class="n">water</span>   <span class="o">|</span>
        <span class="o">|</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.get_trans_vecs">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">get_trans_vecs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">incident_vecs</span></em>, <em class="sig-param"><span class="n">refractive_index</span><span class="o">=</span><span class="default_value">1.33</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_trans_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the many <em>unit vectors</em> of transmitted rays from air to water</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>incident_vecs</strong> (<em>np.ndarray</em>) – vectors representing many incident rays, shape (n, 3)</p></li>
<li><p><strong>refractive_index</strong> (<em>float</em>) – the refractive index of water is 1.33 &#64; 25°C</p></li>
<li><p><strong>normal</strong> (<em>np.ndarray</em>) – the normal vector facing up, the coordinate is looks like</p></li>
</ul>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="o">^</span> <span class="o">+</span><span class="n">z</span>
<span class="n">air</span>     <span class="o">|</span>
        <span class="o">|</span>
<span class="o">------------------&gt;</span>
        <span class="o">|</span>
<span class="n">water</span>   <span class="o">|</span>
        <span class="o">|</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.get_u">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">get_u</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">n</span></em>, <em class="sig-param"><span class="n">d</span></em>, <em class="sig-param"><span class="n">x</span></em>, <em class="sig-param"><span class="n">z</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_u" title="Permalink to this definition">¶</a></dt>
<dd><p>n - relative refractive index
d, x, z - length in mm</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.is_inside_image">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">is_inside_image</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">uv</span></em>, <em class="sig-param"><span class="n">image</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.is_inside_image" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.pl_dist">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">pl_dist</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">point</span></em>, <em class="sig-param"><span class="n">line</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.pl_dist" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate distance between a point and a line in 3D</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>point</strong> (<em>np.ndarray</em>) – shape (3, )</p></li>
<li><p><strong>line</strong> (<em>dict</em>) – {‘unit’: direction, ‘base’: start_point}</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the distance between a line and a point</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.pl_dist_batch">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">pl_dist_batch</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">points</span></em>, <em class="sig-param"><span class="n">lines</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.pl_dist_batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate distance between many points and many lines in 3D</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>points</strong> (<em>np.ndarray</em>) – shape (n, 3,)</p></li>
<li><p><strong>lines</strong> (<em>np.ndarray</em>) – shape (n, view, 2, dim) [dim = 3]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>many distances, shape (n, )</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.pl_dist_faster">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">pl_dist_faster</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">point</span></em>, <em class="sig-param"><span class="n">lines</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.pl_dist_faster" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate distance between a point and a line in 3D</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>point</strong> (<em>np.ndarray</em>) – shape (3,)</p></li>
<li><p><strong>line</strong> (<em>dict</em>) – {‘unit’: direction, ‘base’: start_point}</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the distance between a line and a point</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.py_get_intersect_of_lines_batch">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">py_get_intersect_of_lines_batch</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">lines</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.py_get_intersect_of_lines_batch" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>lines</strong> (<em>np.ndarray</em>) – a collection of many matched lines, shape -&gt; (n, view, 2, 3)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>n points in 3D as the intersect of n * view lines</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.ray_trace_refractive">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">ray_trace_refractive</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">centres</span></em>, <em class="sig-param"><span class="n">cameras</span></em>, <em class="sig-param"><span class="n">z</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em>, <em class="sig-param"><span class="n">refractive_index</span><span class="o">=</span><span class="default_value">1.33</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.ray_trace_refractive" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>centres</strong> – a list of centres (u, v) in different views, they should be undistorted</p></li>
<li><p><strong>cameras</strong> – a list of <em>calibrated</em> Camera objects</p></li>
<li><p><strong>z</strong> – the z-value of the refractive interface</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.ray_trace_refractive_cluster">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">ray_trace_refractive_cluster</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">clusters</span></em>, <em class="sig-param"><span class="n">cameras</span></em>, <em class="sig-param"><span class="n">z</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em>, <em class="sig-param"><span class="n">refractive_index</span><span class="o">=</span><span class="default_value">1.33</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.ray_trace_refractive_cluster" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.ray_trace_refractive_faster">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">ray_trace_refractive_faster</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">centres</span></em>, <em class="sig-param"><span class="n">cameras</span></em>, <em class="sig-param"><span class="n">z</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em>, <em class="sig-param"><span class="n">refractive_index</span><span class="o">=</span><span class="default_value">1.33</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.ray_trace_refractive_faster" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>centres</strong> – a list of centres (u, v) in different views, they should be undistorted</p></li>
<li><p><strong>cameras</strong> – a list of <em>calibrated</em> Camera objects</p></li>
<li><p><strong>z</strong> – the z-value of the refractive interface</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.ray_trace_refractive_trajectory">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">ray_trace_refractive_trajectory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">trajectories</span><span class="p">:</span> <span class="n">List<span class="p">[</span>numpy.ndarray<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">cameras</span><span class="p">:</span> <span class="n">List<span class="p">[</span>Camera<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">z</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em>, <em class="sig-param"><span class="n">refractive_index</span><span class="o">=</span><span class="default_value">1.33</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.ray_trace_refractive_trajectory" title="Permalink to this definition">¶</a></dt>
<dd><p>reconstruct a trajectory from many views
:param trajectories: list of positions belonging to the same individual at different time points, shape (time_points, dim)</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.reproject_refractive">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">reproject_refractive</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xyz</span></em>, <em class="sig-param"><span class="n">camera</span></em>, <em class="sig-param"><span class="n">water_level</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em>, <em class="sig-param"><span class="n">refractive_index</span><span class="o">=</span><span class="default_value">1.333</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.reproject_refractive" title="Permalink to this definition">¶</a></dt>
<dd><p>variable names follwoing <a class="reference external" href="https://ieeexplore.ieee.org/document/5957554">https://ieeexplore.ieee.org/document/5957554</a>, figure 1</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.reproject_refractive_no_distort">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">reproject_refractive_no_distort</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xyz</span></em>, <em class="sig-param"><span class="n">camera</span></em>, <em class="sig-param"><span class="n">water_level</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em>, <em class="sig-param"><span class="n">refractive_index</span><span class="o">=</span><span class="default_value">1.333</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.reproject_refractive_no_distort" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.ray_trace.same_direction">
<code class="sig-prename descclassname">fish_3d.ray_trace.</code><code class="sig-name descname">same_direction</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">v1</span></em>, <em class="sig-param"><span class="n">v2</span></em>, <em class="sig-param"><span class="n">v3</span></em>, <em class="sig-param"><span class="n">axis</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.same_direction" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-fish_3d.stereolink">
<span id="fish-3d-stereolink-module"></span><h2>fish_3d.stereolink module<a class="headerlink" href="#module-fish_3d.stereolink" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="fish_3d.stereolink.extra_three_view_cluster_match">
<code class="sig-prename descclassname">fish_3d.stereolink.</code><code class="sig-name descname">extra_three_view_cluster_match</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">matched_indices</span></em>, <em class="sig-param"><span class="n">clusters_multi_view</span></em>, <em class="sig-param"><span class="n">cameras</span></em>, <em class="sig-param"><span class="n">tol_2d</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">sample_size</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">depth</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">report</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em>, <em class="sig-param"><span class="n">water_level</span><span class="o">=</span><span class="default_value">0.0</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.extra_three_view_cluster_match" title="Permalink to this definition">¶</a></dt>
<dd><p>match clusters tanking simutaneously by three cameras
pretending only features that DID NOT correspond to indices in
<cite>matched_indices</cite> appear in the view
matched_indices: shape (number, view)</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.stereolink.get_fundamental_from_projections">
<code class="sig-prename descclassname">fish_3d.stereolink.</code><code class="sig-name descname">get_fundamental_from_projections</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">p1</span></em>, <em class="sig-param"><span class="n">p2</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.get_fundamental_from_projections" title="Permalink to this definition">¶</a></dt>
<dd><p>p1: projection matrix of camera for image 1, shape (3, 4)
p2: projection matrix of camera for image 2, shape (3, 4)
F: fundamental matrix, shape (3, 3)
image 1 —&gt; image 2
point_1’ * F * point_2 = 0</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.stereolink.get_partial_cluster">
<code class="sig-prename descclassname">fish_3d.stereolink.</code><code class="sig-name descname">get_partial_cluster</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cluster</span></em>, <em class="sig-param"><span class="n">size</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.get_partial_cluster" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.stereolink.greedy_match">
<code class="sig-prename descclassname">fish_3d.stereolink.</code><code class="sig-name descname">greedy_match</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">clusters</span></em>, <em class="sig-param"><span class="n">cameras</span></em>, <em class="sig-param"><span class="n">depth</span></em>, <em class="sig-param"><span class="n">normal</span></em>, <em class="sig-param"><span class="n">water_level</span></em>, <em class="sig-param"><span class="n">tol_2d</span></em>, <em class="sig-param"><span class="n">sample_size</span><span class="o">=</span><span class="default_value">10</span></em>, <em class="sig-param"><span class="n">report</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">order</span><span class="o">=</span><span class="default_value">0, 1, 2</span></em>, <em class="sig-param"><span class="n">history</span><span class="o">=</span><span class="default_value">array([], shape=0, 3, dtype=float64)</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.greedy_match" title="Permalink to this definition">¶</a></dt>
<dd><p>use greedy algorithm to match clusters across THREE views</p>
<dl class="simple">
<dt>start from view_1:</dt><dd><dl class="simple">
<dt>start from cluster_1:</dt><dd><ol class="arabic simple">
<li><p>find all possible correspondance according to epipolar
relationship in view 2 and view 3</p></li>
<li><p>for all possibility in view 2, validate according to ray-tracing</p></li>
<li><p>for all possibility in view 3, validate according to ray-tracing</p></li>
</ol>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>clusters</strong> – A collection of points in the 2D image
with the format of (u, v), NOT (x, y)</p></li>
<li><p><strong>cameras</strong> – A collection of Camera instances</p></li>
<li><p><strong>depth</strong> – The maximum depth of water used to constrain
the length of the epipolar relation</p></li>
<li><p><strong>normal</strong> – The direction of the normal of the water.
It should be [0, 0, 1]</p></li>
<li><p><strong>tol_2d</strong> – The tolerance on the distance between epipolar line
and centers, unit is pixel</p></li>
<li><p><strong>points</strong> – the number of points used in 3D stereo matching
for each cluster, choosing randomly</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The matched indices across different views.
The indices are for the clusters.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.stereolink.join_pairs">
<code class="sig-prename descclassname">fish_3d.stereolink.</code><code class="sig-name descname">join_pairs</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">pairs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.join_pairs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.stereolink.line2func">
<code class="sig-prename descclassname">fish_3d.stereolink.</code><code class="sig-name descname">line2func</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">line</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.line2func" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.stereolink.match_clusters">
<code class="sig-prename descclassname">fish_3d.stereolink.</code><code class="sig-name descname">match_clusters</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">clusters</span></em>, <em class="sig-param"><span class="n">cameras</span></em>, <em class="sig-param"><span class="n">normal</span></em>, <em class="sig-param"><span class="n">water_level</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.match_clusters" title="Permalink to this definition">¶</a></dt>
<dd><p>return allowed 3d points given matched clusters in different views
the error is the average of perpendicular of 3D points to the three rays,
unit is mm</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.stereolink.match_points_v3">
<code class="sig-prename descclassname">fish_3d.stereolink.</code><code class="sig-name descname">match_points_v3</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cameras</span><span class="p">:</span> <span class="n">List<span class="p">[</span>Camera<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">points</span><span class="p">:</span> <span class="n">List<span class="p">[</span>numpy.ndarray<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">max_cost</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.match_points_v3" title="Permalink to this definition">¶</a></dt>
<dd><p>match points in three views
no refractions were considered
:param cameras: a list of three cameras
:param points: (x, y) coordinates in three views</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.stereolink.multi_view_link">
<code class="sig-prename descclassname">fish_3d.stereolink.</code><code class="sig-name descname">multi_view_link</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">c1</span></em>, <em class="sig-param"><span class="n">c2</span></em>, <em class="sig-param"><span class="n">f</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.multi_view_link" title="Permalink to this definition">¶</a></dt>
<dd><p>c1: homogenerous centres in image 1, shape (N, 3)
c2: homogenerous centres in image 2, shape (N, 3)
supposing centres in image 1 is in the right order (order of c1)
c2[order] gives the right order of objects in image 2</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.stereolink.remove_conflict">
<code class="sig-prename descclassname">fish_3d.stereolink.</code><code class="sig-name descname">remove_conflict</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">matched_indices</span></em>, <em class="sig-param"><span class="n">matched_centres</span></em>, <em class="sig-param"><span class="n">reproj_errors</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.remove_conflict" title="Permalink to this definition">¶</a></dt>
<dd><p>Only allow each unique feature, indicated by a number in <cite>matched_indices</cite>,
appear once for each view
That is to say, fish #1 and fish #2 is NOT allowed to the SAME blob
in the same picture.
This means all values in matched_indices.T should be unique along
three views
It works for n views
matched_indices: shape (number, view)</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.stereolink.remove_overlap">
<code class="sig-prename descclassname">fish_3d.stereolink.</code><code class="sig-name descname">remove_overlap</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">centres</span></em>, <em class="sig-param"><span class="n">errors</span></em>, <em class="sig-param"><span class="n">search_range</span><span class="o">=</span><span class="default_value">10</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.remove_overlap" title="Permalink to this definition">¶</a></dt>
<dd><p>centres: possible fish locations, array shape (number, dimension)
errors: reprojection errors of COM of different clouds, shape (number, )
overlap = convex hull overlap; vertices of ch1 goes into ch2</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.stereolink.three_view_cluster_match">
<code class="sig-prename descclassname">fish_3d.stereolink.</code><code class="sig-name descname">three_view_cluster_match</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">clusters_multi_view</span></em>, <em class="sig-param"><span class="n">cameras</span></em>, <em class="sig-param"><span class="n">tol_2d</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">sample_size</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">depth</span><span class="p">:</span> <span class="n">float</span></em>, <em class="sig-param"><span class="n">report</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em>, <em class="sig-param"><span class="n">water_level</span><span class="o">=</span><span class="default_value">0.0</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.three_view_cluster_match" title="Permalink to this definition">¶</a></dt>
<dd><p>match clusters tanking simutaneously by three cameras
the clusters were assumed to be in water, n = 1.333</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.stereolink.triangulation_v3">
<code class="sig-prename descclassname">fish_3d.stereolink.</code><code class="sig-name descname">triangulation_v3</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">positions</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em>, <em class="sig-param"><span class="n">cameras</span><span class="p">:</span> <span class="n">List<span class="p">[</span>Camera<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.triangulation_v3" title="Permalink to this definition">¶</a></dt>
<dd><p>the positions in different views should be undistorted</p>
</dd></dl>

</div>
<div class="section" id="module-fish_3d.utility">
<span id="fish-3d-utility-module"></span><h2>fish_3d.utility module<a class="headerlink" href="#module-fish_3d.utility" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="fish_3d.utility.box_count_polar_image">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">box_count_polar_image</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span></em>, <em class="sig-param"><span class="n">indices</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.box_count_polar_image" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> – the image taken by the camera without undistortion</p></li>
<li><p><strong>labels</strong> – labelled image specifying different box regions</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.box_count_polar_video">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">box_count_polar_video</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">video</span></em>, <em class="sig-param"><span class="n">labels</span></em>, <em class="sig-param"><span class="n">cores</span><span class="o">=</span><span class="default_value">2</span></em>, <em class="sig-param"><span class="n">report</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.box_count_polar_video" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.get_ABCD">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">get_ABCD</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">corners</span><span class="p">:</span> <span class="n">numpy.array</span></em>, <em class="sig-param"><span class="n">width</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">excess_rows</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span> &#x2192; dict<a class="headerlink" href="#fish_3d.utility.get_ABCD" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>corners</strong> – the coordinates of chessboard corners
found by cv2.findChessboardCorners, shape (n, 2)</p></li>
<li><p><strong>width</strong> – the number of corners in a row</p></li>
<li><p><strong>excess_rows</strong> – if the chessboard is make of (m, n) corners (m &gt; n)
then n is <em>width</em>, excess_rows = m - n</p></li>
</ul>
</dd>
</dl>
<p>what is ABCD?
C +——-+ D</p>
<blockquote>
<div><div class="line-block">
<div class="line"><a href="#id1"><span class="problematic" id="id2">|</span></a></div>
<div class="line"><a href="#id3"><span class="problematic" id="id4">|</span></a></div>
<div class="line"><a href="#id5"><span class="problematic" id="id6">|</span></a></div>
</div>
</div></blockquote>
<p>A +——-+ B
(AB // CD, AC // BD)</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.get_affinity">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">get_affinity</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">abcd</span><span class="p">:</span> <span class="n">dict</span></em><span class="sig-paren">)</span> &#x2192; numpy.array<a class="headerlink" href="#fish_3d.utility.get_affinity" title="Permalink to this definition">¶</a></dt>
<dd><p>get the affinity matrix from a set of corners measured from
a chessboard image
:param abcd: a dict storing the measured coordinates of chessboard corners
what is ABCD?
C +——-+ D</p>
<blockquote>
<div><div class="line-block">
<div class="line"><a href="#id7"><span class="problematic" id="id8">|</span></a></div>
<div class="line"><a href="#id9"><span class="problematic" id="id10">|</span></a></div>
<div class="line"><a href="#id11"><span class="problematic" id="id12">|</span></a></div>
</div>
</div></blockquote>
<p>A +——-+ B</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.get_clusters">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">get_clusters</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span></em>, <em class="sig-param"><span class="n">threshold</span></em>, <em class="sig-param"><span class="n">min_size</span></em>, <em class="sig-param"><span class="n">roi</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_clusters" title="Permalink to this definition">¶</a></dt>
<dd><p>apply threshold to image and label disconnected part
small labels (size &lt; min_size) were erased
the coordinates of labels were returned, shape: (label_number, 3)</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.get_corners">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">get_corners</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span><span class="p">:</span> <span class="n">numpy.array</span></em>, <em class="sig-param"><span class="n">rows</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">cols</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">camera_model</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_corners" title="Permalink to this definition">¶</a></dt>
<dd><p>use findChessboardCorners in opencv to get coordinates of corners</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.get_homography">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">get_homography</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">camera</span><span class="p">:</span> <span class="n">Camera</span></em>, <em class="sig-param"><span class="n">angle_num</span><span class="o">=</span><span class="default_value">10</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_homography" title="Permalink to this definition">¶</a></dt>
<dd><p>get the homography that simiarly recover the 2d image perpendicular to z-axis
:param camera: a Camera instance of current camera
:param angle_num: a virtual chessboard is rotated angle_num times for calculation</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.get_homography_image">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">get_homography_image</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span><span class="p">:</span> <span class="n">numpy.array</span></em>, <em class="sig-param"><span class="n">rows</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">cols</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">camera_model</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_homography_image" title="Permalink to this definition">¶</a></dt>
<dd><p>get the homography transformation
from an image with a chess-board
image: 2d numpy array
rows: the number of <em>internal corners</em> inside each row
cols: the number of <em>internal corners</em> inside each column
camera_model: (optional) a Camera instance that stores the</p>
<blockquote>
<div><p>distortion coefficients of the lens</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.get_indices">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">get_indices</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">labels</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_indices" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.get_orient_line">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">get_orient_line</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">locations</span></em>, <em class="sig-param"><span class="n">orientations</span></em>, <em class="sig-param"><span class="n">length</span><span class="o">=</span><span class="default_value">10</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_orient_line" title="Permalink to this definition">¶</a></dt>
<dd><p>get the line for plot the orientations
:param locations: shape (n, 2)
:param orientations: shape (n, )</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.get_similarity">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">get_similarity</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">abcd</span><span class="p">:</span> <span class="n">dict</span></em>, <em class="sig-param"><span class="n">H_aff</span><span class="p">:</span> <span class="n">numpy.array</span></em><span class="sig-paren">)</span> &#x2192; numpy.array<a class="headerlink" href="#fish_3d.utility.get_similarity" title="Permalink to this definition">¶</a></dt>
<dd><p>get the similarity matrix from a set of corners measured from
a chessboard image
:param abcd: a dict storing the measured coordinates of chessboard corners
:param H_aff: affinity that makes coordinates affinely recitified
what is ABCD?
C +——-+ D</p>
<blockquote>
<div><div class="line-block">
<div class="line"><a href="#id13"><span class="problematic" id="id14">|</span></a></div>
<div class="line"><a href="#id15"><span class="problematic" id="id16">|</span></a></div>
<div class="line"><a href="#id17"><span class="problematic" id="id18">|</span></a></div>
</div>
</div></blockquote>
<p>A +——-+ B</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.plot_epl">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">plot_epl</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">line</span><span class="p">:</span> <span class="n">List<span class="p">[</span>float<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">image</span><span class="p">:</span> <span class="n">numpy.ndarray</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.plot_epl" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the scatters of an epipolar line <em>inside</em> an image
The images is considered as being stored in (row [y], column [x])</p>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.plot_reproject">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">plot_reproject</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span></em>, <em class="sig-param"><span class="n">features</span></em>, <em class="sig-param"><span class="n">pos_3d</span></em>, <em class="sig-param"><span class="n">camera</span></em>, <em class="sig-param"><span class="n">filename</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">water_level</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.plot_reproject" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.plot_reproject_with_roi">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">plot_reproject_with_roi</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span></em>, <em class="sig-param"><span class="n">roi</span></em>, <em class="sig-param"><span class="n">features</span></em>, <em class="sig-param"><span class="n">pos_3d</span></em>, <em class="sig-param"><span class="n">camera</span></em>, <em class="sig-param"><span class="n">filename</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">water_level</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">normal</span><span class="o">=</span><span class="default_value">0, 0, 1</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.plot_reproject_with_roi" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.polar_chop">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">polar_chop</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image</span></em>, <em class="sig-param"><span class="n">H_sim</span></em>, <em class="sig-param"><span class="n">centre</span></em>, <em class="sig-param"><span class="n">radius</span></em>, <em class="sig-param"><span class="n">n_angle</span></em>, <em class="sig-param"><span class="n">n_radius</span></em>, <em class="sig-param"><span class="n">dist_coef</span></em>, <em class="sig-param"><span class="n">k</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.polar_chop" title="Permalink to this definition">¶</a></dt>
<dd><p>Chop an image in the polar coordinates
return the chopped result as a labelled image
:param image: 2d image as a numpy array
:param H_sim: a homography (3 x 3 matrix) to similarly rectify the image
:param centre: origin of the polar coordinate system
:param radius: maximum radius in the polar coordinate system
:param n_angle: number of bins in terms of angle
:param n_radius: number of bins in terms of radius
:param dist_coef: distortion coefficients of the camera, shape (5, )</p>
<blockquote>
<div><p>k1, k2, p1, p2, k3 (from opencv by default)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>k</strong> – camera calibration matrix (bible, P155)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.see_corners">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">see_corners</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">image_file</span></em>, <em class="sig-param"><span class="n">corner_number</span><span class="o">=</span><span class="default_value">23, 15</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.see_corners" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt id="fish_3d.utility.update_orientation">
<code class="sig-prename descclassname">fish_3d.utility.</code><code class="sig-name descname">update_orientation</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">orientations</span><span class="p">:</span> <span class="n">numpy.array</span></em>, <em class="sig-param"><span class="n">locations</span><span class="p">:</span> <span class="n">numpy.array</span></em>, <em class="sig-param"><span class="n">H</span><span class="p">:</span> <span class="n">numpy.array</span></em>, <em class="sig-param"><span class="n">length</span><span class="o">=</span><span class="default_value">10</span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.update_orientation" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the orientatin after applying homography H
This is function is used to get a ‘recitified’ orientation
:param orientation: angles of the fish, sin(angle) –&gt; x very sadly
:param locatons: xy positons of fish in the image, not row-col
:param H: the homography matrix
:param length: length of the orientation bar</p>
</dd></dl>

</div>
<div class="section" id="module-fish_3d">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-fish_3d" title="Permalink to this headline">¶</a></h2>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="modules.html">FishPy</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="fish_corr.html">fish_corr package</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Yushi Yang.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.1.
    </div>
  </body>
</html>