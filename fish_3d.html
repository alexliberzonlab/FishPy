
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>fish_3d package &#8212; FishPy  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/haiku.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="fish_corr package" href="fish_corr.html" />
    <link rel="prev" title="FishPy Modules" href="modules.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>FishPy  documentation</span></a></h1>
        <h2 class="heading"><span>fish_3d package</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="modules.html">FishPy Modules</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="fish_corr.html">fish_corr package</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="fish-3d-package">
<h1>fish_3d package<a class="headerlink" href="#fish-3d-package" title="Permalink to this headline">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</section>
<section id="module-fish_3d.camera">
<span id="fish-3d-camera-module"></span><h2>fish_3d.camera module<a class="headerlink" href="#module-fish_3d.camera" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="fish_3d.camera.Camera">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">fish_3d.camera.</span></span><span class="sig-name descname"><span class="pre">Camera</span></span><a class="headerlink" href="#fish_3d.camera.Camera" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>This class holds intrinsic/extrinsic parameters of a camera, with some handy functions</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.self.r">
<span class="sig-prename descclassname"><span class="pre">self.</span></span><span class="sig-name descname"><span class="pre">r</span></span><a class="headerlink" href="#fish_3d.camera.Camera.self.r" title="Permalink to this definition">¶</a></dt>
<dd><p>rotation matrix of the camera, shape (3, 3)</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.self.ext">
<span class="sig-prename descclassname"><span class="pre">self.</span></span><span class="sig-name descname"><span class="pre">ext</span></span><a class="headerlink" href="#fish_3d.camera.Camera.self.ext" title="Permalink to this definition">¶</a></dt>
<dd><p>extrinsic parameters, # R, t –&gt; [R|t]</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.self.p">
<span class="sig-prename descclassname"><span class="pre">self.</span></span><span class="sig-name descname"><span class="pre">p</span></span><a class="headerlink" href="#fish_3d.camera.Camera.self.p" title="Permalink to this definition">¶</a></dt>
<dd><p>projection matrix int &#64; ext</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.self.o">
<span class="sig-prename descclassname"><span class="pre">self.</span></span><span class="sig-name descname"><span class="pre">o</span></span><a class="headerlink" href="#fish_3d.camera.Camera.self.o" title="Permalink to this definition">¶</a></dt>
<dd><p>origin of the camera, shape (3, 1)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.calibrate">
<span class="sig-name descname"><span class="pre">calibrate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">int_images</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><span class="pre">list</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ext_image</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">grid_size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'x123'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corner_number</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(6,</span> <span class="pre">6)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">win_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(5,</span> <span class="pre">5)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.calibrate" title="Permalink to this definition">¶</a></dt>
<dd><p>update intrinsic and extrinsic camera matrix using opencv’s chessboard detector
the distortion coefficients are also being detected
the corner number should be in the format of (row, column)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.calibrate_ext">
<span class="sig-name descname"><span class="pre">calibrate_ext</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ext_image</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><span class="pre">str</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">grid_size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'x123'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corner_number</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(6,</span> <span class="pre">6)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">win_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(5,</span> <span class="pre">5)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.calibrate_ext" title="Permalink to this definition">¶</a></dt>
<dd><p>update EXTRINSIC camera matrix using opencv’s chessboard detector
the distortion coefficients are also being detected
the corner number should be in the format of (row, column)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.calibrate_int">
<span class="sig-name descname"><span class="pre">calibrate_int</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">int_images</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><span class="pre">list</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">grid_size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">corner_number</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(6,</span> <span class="pre">6)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">win_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(5,</span> <span class="pre">5)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">show</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.calibrate_int" title="Permalink to this definition">¶</a></dt>
<dd><p>update INTERINSIC camera matrix using opencv’s chessboard detector
the distortion coefficients are also being detected
the corner number should be in the format of (row, column)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.load_json">
<span class="sig-name descname"><span class="pre">load_json</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.load_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Recover essential parameters from a json file</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.project">
<span class="sig-name descname"><span class="pre">project</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">position</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.array</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.project" title="Permalink to this definition">¶</a></dt>
<dd><p>Project a 3D position onto the image plane</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>position</strong> (<em>np.ndarray</em>) – a collection of 3D poitns, shape (n, 3)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.project_refractive">
<span class="sig-name descname"><span class="pre">project_refractive</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">positions</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.project_refractive" title="Permalink to this definition">¶</a></dt>
<dd><p>Project the 3D points under water
the normal water-air interface is assumed to be (0, 0, 1)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>positions</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>) – a collection of 3d points, shape (n, 3)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the projected 2D locations, shape (n, 2)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.read_calibration">
<span class="sig-name descname"><span class="pre">read_calibration</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mat_file</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.read_calibration" title="Permalink to this definition">¶</a></dt>
<dd><p>Read calibration result from TOOLBOX_calib
The calibration result is generated by following Matlab script:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">save</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;fc&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;cc&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Tc_ext&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Rc_ext&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.read_int">
<span class="sig-name descname"><span class="pre">read_int</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">another</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.read_int" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.redistort_points">
<span class="sig-name descname"><span class="pre">redistort_points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">points</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.array</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.redistort_points" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>points</strong> (<em>np.ndarray</em>) – undistorted image coordinates (u, v) in pixels, shape (2, n)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the distorted points</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><span class="pre">str</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Save instance as a python binary object</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.save_json">
<span class="sig-name descname"><span class="pre">save_json</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.save_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump essential parameters to a json file</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.undistort">
<span class="sig-name descname"><span class="pre">undistort</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">point</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">want_uv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.undistort" title="Permalink to this definition">¶</a></dt>
<dd><p>undistort point in an image, coordinate is (u, v)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>point</strong> (<em>np.ndarray</em>) – the points to be undistorted</p></li>
<li><p><strong>want_uv</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><em>bool</em></a>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>undistorted points, being xy, not uv (camera.K &#64; xy = uv)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.undistort_image">
<span class="sig-name descname"><span class="pre">undistort_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.array</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.undistort_image" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> (<em>np.ndarray</em>) – an image taken by the camera</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a undistorted 2D image</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.undistort_points">
<span class="sig-name descname"><span class="pre">undistort_points</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">points</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">want_uv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.undistort_points" title="Permalink to this definition">¶</a></dt>
<dd><p>Undistort many points in an image, coordinate is (u, v), NOT (x, y)</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>undistorted version of (x’, y’) or (u’, v’), shape (n, 2)</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>np.ndarray</p>
</dd>
</dl>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">&#39;</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">fx</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">cx</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">u</span><span class="o">&#39;</span><span class="w"></span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.unzip_essential">
<span class="sig-name descname"><span class="pre">unzip_essential</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.unzip_essential" title="Permalink to this definition">¶</a></dt>
<dd><p>Unpack essential parameters from a dict and load them as attributes</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.update" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="fish_3d.camera.Camera.zip_essential">
<span class="sig-name descname"><span class="pre">zip_essential</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.Camera.zip_essential" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>pack all essential parameters into a dict which can be dumped</dt><dd><p>as a json file</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.camera.calib_mult_ext">
<span class="sig-prename descclassname"><span class="pre">fish_3d.camera.</span></span><span class="sig-name descname"><span class="pre">calib_mult_ext</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cam_1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cam_2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cam_3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">images_v1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">images_v2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">images_v3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders_v1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders_v2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orders_v3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grid_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corner_number</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">win_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(10,</span> <span class="pre">10)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.calib_mult_ext" title="Permalink to this definition">¶</a></dt>
<dd><p>Do extrinsic calibrations multiple times, calculate average <em>relative displacement &amp; angle</em>
Then use the <strong>last</strong> calibration image as world coordinate</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cam_1</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – The internal parameters should be correct</p></li>
<li><p><strong>cam_2</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – The internal parameters should be correct</p></li>
<li><p><strong>cam_3</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – The internal parameters should be correct</p></li>
<li><p><strong>images_v1</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – calibrations image filenames for camera 1</p></li>
<li><p><strong>images_v2</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – calibrations image filenames for camera 2</p></li>
<li><p><strong>images_v3</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – calibrations image filenames for camera 3</p></li>
<li><p><strong>orders_v1</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – The order of ‘x123’ or ‘321x’ for each calibration imags for camera 1</p></li>
<li><p><strong>orders_v2</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – The order of ‘x123’ or ‘321x’ for each calibration imags for camera 2</p></li>
<li><p><strong>orders_v3</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – The order of ‘x123’ or ‘321x’ for each calibration imags for camera 3</p></li>
<li><p><strong>grid_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – size of a single grid in chessboard, only support square grids</p></li>
<li><p><strong>corner_number</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><em>tuple</em></a>) – (horizontal, vertical), specifying the number of corners in each direction
corner_number = grid_number - 1</p></li>
<li><p><strong>win_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><em>tuple</em></a>) – Search parameter in the opencv</p></li>
</ul>
</dd>
</dl>
<p>Equations (&#64; is dot product)</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">x1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">r1</span><span class="w">  </span><span class="p">@</span><span class="w"> </span><span class="n">xw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t1</span><span class="w">   </span><span class="p">(</span><span class="n">world</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">camera</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="n">obtained</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">Camera</span><span class="p">.</span><span class="n">calibrate_ext</span><span class="p">)</span><span class="w"></span>
<span class="n">x2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">r2</span><span class="w">  </span><span class="p">@</span><span class="w"> </span><span class="n">xw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t2</span><span class="w">   </span><span class="p">(</span><span class="n">world</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">camera</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="n">obtained</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">Camera</span><span class="p">.</span><span class="n">calibrate_ext</span><span class="p">)</span><span class="w"></span>
<span class="n">x2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">r12</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="n">x1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t12</span><span class="w">  </span><span class="p">(</span><span class="n">camera</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">camera</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="o">--&gt;</span><span class="w"> </span><span class="n">r12</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="n">r1</span><span class="o">&#39;</span><span class="w"></span>
<span class="o">--&gt;</span><span class="w"> </span><span class="n">t12</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="n">r1</span><span class="o">&#39;</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="n">t1</span><span class="w"></span>
<span class="o">--&gt;</span><span class="w"> </span><span class="n">t2</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="n">t12</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r12</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="n">t1</span><span class="w"></span>
<span class="o">--&gt;</span><span class="w"> </span><span class="n">r2</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="n">r12</span><span class="w"> </span><span class="p">@</span><span class="w"> </span><span class="n">r1</span><span class="w"></span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.camera.detect_chessboard">
<span class="sig-prename descclassname"><span class="pre">fish_3d.camera.</span></span><span class="sig-name descname"><span class="pre">detect_chessboard</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corner_number</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">win_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.detect_chessboard" title="Permalink to this definition">¶</a></dt>
<dd><p>Find the corners on a chessboard</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>np.ndarray</em>) – a 2D image.</p></li>
<li><p><strong>corner_number</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><em>tuple</em></a>) – the number of points on each side</p></li>
<li><p><strong>win_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – for optimisation</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the location of corners in the image. shape (n, 2)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.camera.draw">
<span class="sig-prename descclassname"><span class="pre">fish_3d.camera.</span></span><span class="sig-name descname"><span class="pre">draw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axes</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.draw" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.camera.find_pairs">
<span class="sig-prename descclassname"><span class="pre">fish_3d.camera.</span></span><span class="sig-name descname"><span class="pre">find_pairs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">arr_1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arr_2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.find_pairs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.camera.get_fundamental">
<span class="sig-prename descclassname"><span class="pre">fish_3d.camera.</span></span><span class="sig-name descname"><span class="pre">get_fundamental</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cam_1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><span class="pre">fish_3d.camera.Camera</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">cam_2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><span class="pre">fish_3d.camera.Camera</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.get_fundamental" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the fundamental matrix between two cameras</p>
<p>In the actually calculation, rotate axes of camera 2, so that external of camera 1 is <code class="docutils literal notranslate"><span class="pre">[E|0]</span></code></p>
<p>(ref: <a class="reference external" href="https://sourishghosh.com/2016/fundamental-matrix-from-camera-matrices/">https://sourishghosh.com/2016/fundamental-matrix-from-camera-matrices/</a>)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cam_1</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – Camera instance  whose P, K, R, t, o are all known</p></li>
<li><p><strong>cam_2</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – Camera instance  whose P, K, R, t, o are all known</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>the fundamental matrix F, where</dt><dd><ol class="arabic simple">
<li><p>x2.T &#64; F &#64; x1 = 0</p></li>
<li><p>F &#64; x1 = l2  (epipolar line)</p></li>
</ol>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.camera.get_points_from_order">
<span class="sig-prename descclassname"><span class="pre">fish_3d.camera.</span></span><span class="sig-name descname"><span class="pre">get_points_from_order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">corner_number</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'x123'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.get_points_from_order" title="Permalink to this definition">¶</a></dt>
<dd><p>the expected calibration image is</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span>┌───────┬───────┬───────┐<span class="w"></span>
│<span class="w">  </span>╲<span class="w"> </span>╱<span class="w">  </span>│◜◜◜◜◜◜◜│<span class="w">   </span>╮<span class="w">   </span>│<span class="w"></span>
│<span class="w">   </span>╳<span class="w">   </span>│◜◜◜◜◜◜◜│<span class="w">   </span>│<span class="w">   </span>│<span class="w"></span>
│<span class="w">  </span>╱<span class="w"> </span>╲<span class="w">  </span>│◜◜◜◜◜◜◜│<span class="w">   </span>┴<span class="w">   </span>│<span class="w"></span>
├───────┼───────┼───────┤<span class="w"></span>
│◜◜◜◜◜◜◜│<span class="w">       </span>│◜◜◜◜◜◜◜│<span class="w"></span>
│◜◜◜◜◜◜◜│<span class="w">       </span>│◜◜◜◜◜◜◜│<span class="w"></span>
│◜◜◜◜◜◜◜│<span class="w">       </span>│◜◜◜◜◜◜◜│<span class="w"></span>
├───────┼───────┼───────┤<span class="w"></span>
│<span class="w">  </span>╶─╮<span class="w">  </span>│◜◜◜◜◜◜◜│<span class="w">   </span>──┐<span class="w"> </span>│<span class="w"></span>
│<span class="w">  </span>╭─╯<span class="w">  </span>│◜◜◜◜◜◜◜│<span class="w">   </span>╶─┤<span class="w"> </span>│<span class="w"></span>
│<span class="w">  </span>╰──<span class="w">  </span>│◜◜◜◜◜◜◜│<span class="w">   </span>──┘<span class="w"> </span>│<span class="w"></span>
└───────┴───────┴───────┘<span class="w"></span>
</pre></div>
</div>
<p>and the corresponding order is x123 (row, colume)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.camera.get_reproject_error">
<span class="sig-prename descclassname"><span class="pre">fish_3d.camera.</span></span><span class="sig-name descname"><span class="pre">get_reproject_error</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">points_2d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">points_3d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rvec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tvec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distort</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_matrix</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.get_reproject_error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.camera.plot_cameras">
<span class="sig-prename descclassname"><span class="pre">fish_3d.camera.</span></span><span class="sig-name descname"><span class="pre">plot_cameras</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">axis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.camera.plot_cameras" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-fish_3d.cgreta">
<span id="fish-3d-cgreta-module"></span><h2>fish_3d.cgreta module<a class="headerlink" href="#module-fish_3d.cgreta" title="Permalink to this headline">¶</a></h2>
<p>GReTA tracking</p>
<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.cgreta.get_trajs_3d">
<span class="sig-prename descclassname"><span class="pre">fish_3d.cgreta.</span></span><span class="sig-name descname"><span class="pre">get_trajs_3d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frames_v3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List[List[numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]][3]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stereo_links</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">project_matrices</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List[numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]][3]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_origins</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List[numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]][3]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c_max</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_range</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">re_max</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List[Tuple[numpy.ndarray[numpy.float64[m,</span> <span class="pre">3]],</span> <span class="pre">float]]</span></span></span><a class="headerlink" href="#fish_3d.cgreta.get_trajs_3d" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.cgreta.get_trajs_3d_t1t2">
<span class="sig-prename descclassname"><span class="pre">fish_3d.cgreta.</span></span><span class="sig-name descname"><span class="pre">get_trajs_3d_t1t2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frames_v3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List[List[numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]][3]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stereo_links</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">project_matrices</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List[numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]][3]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_origins</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List[numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]][3]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c_max</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_range</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_range_traj</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">re_max</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List[Tuple[numpy.ndarray[numpy.float64[m,</span> <span class="pre">3]],</span> <span class="pre">float]]</span></span></span><a class="headerlink" href="#fish_3d.cgreta.get_trajs_3d_t1t2" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.cgreta.get_trajs_3d_t1t2t3">
<span class="sig-prename descclassname"><span class="pre">fish_3d.cgreta.</span></span><span class="sig-name descname"><span class="pre">get_trajs_3d_t1t2t3</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frames_v3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List[List[numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]][3]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stereo_links</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">project_matrices</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List[numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]][3]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_origins</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List[numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]][3]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c_max</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_range</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_range_traj</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau_3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">re_max</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List[Tuple[numpy.ndarray[numpy.float64[m,</span> <span class="pre">3]],</span> <span class="pre">float]]</span></span></span><a class="headerlink" href="#fish_3d.cgreta.get_trajs_3d_t1t2t3" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-fish_3d.cray_trace">
<span id="fish-3d-cray-trace-module"></span><h2>fish_3d.cray_trace module<a class="headerlink" href="#module-fish_3d.cray_trace" title="Permalink to this headline">¶</a></h2>
<p>refractive ray tracing</p>
<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.cray_trace.get_intersect_multiple">
<span class="sig-prename descclassname"><span class="pre">fish_3d.cray_trace.</span></span><span class="sig-name descname"><span class="pre">get_intersect_multiple</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">18],</span> <span class="pre">flags.c_contiguous]</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">3]]</span></span></span><a class="headerlink" href="#fish_3d.cray_trace.get_intersect_multiple" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the points that are closest to a collection of multiple lines</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.cray_trace.get_intersect_of_lines">
<span class="sig-prename descclassname"><span class="pre">fish_3d.cray_trace.</span></span><span class="sig-name descname"><span class="pre">get_intersect_of_lines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><span class="pre">numpy.ndarray</span></a><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><span class="pre">numpy.ndarray</span></a><span class="p"><span class="pre">[</span></span><span class="pre">numpy.float64</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#fish_3d.cray_trace.get_intersect_of_lines" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the point that are closest to multiple lines</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.cray_trace.get_intersect_single">
<span class="sig-prename descclassname"><span class="pre">fish_3d.cray_trace.</span></span><span class="sig-name descname"><span class="pre">get_intersect_single</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">6],</span> <span class="pre">flags.c_contiguous]</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">numpy.ndarray[numpy.float64[1,</span> <span class="pre">3]]</span></span></span><a class="headerlink" href="#fish_3d.cray_trace.get_intersect_single" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the point that is closest to multiple lines</p>
</dd></dl>

</section>
<section id="module-fish_3d.cstereo">
<span id="fish-3d-cstereo-module"></span><h2>fish_3d.cstereo module<a class="headerlink" href="#module-fish_3d.cstereo" title="Permalink to this headline">¶</a></h2>
<p>stereo matching &amp; greta tracking</p>
<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.cstereo.get_error">
<span class="sig-prename descclassname"><span class="pre">fish_3d.cstereo.</span></span><span class="sig-name descname"><span class="pre">get_error</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">centres</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List[numpy.ndarray[numpy.float64[2,</span> <span class="pre">1]][3]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ps</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List[numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]][3]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Os</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List[numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]][3]]</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></span><a class="headerlink" href="#fish_3d.cstereo.get_error" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.cstereo.locate_v3">
<span class="sig-prename descclassname"><span class="pre">fish_3d.cstereo.</span></span><span class="sig-name descname"><span class="pre">locate_v3</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">centres_1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">centres_2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">centres_3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">O1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">O2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">O3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol_2d</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimise</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><span class="pre">bool</span></a></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple[numpy.ndarray[numpy.float64[m,</span> <span class="pre">3]],</span> <span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">1]]]</span></span></span><a class="headerlink" href="#fish_3d.cstereo.locate_v3" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.cstereo.match_v3">
<span class="sig-prename descclassname"><span class="pre">fish_3d.cstereo.</span></span><span class="sig-name descname"><span class="pre">match_v3</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">centres_1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">centres_2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">centres_3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">O1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">O2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">O3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol_2d</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimise</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><span class="pre">bool</span></a></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">,</span> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#fish_3d.cstereo.match_v3" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.cstereo.match_v3_verbose">
<span class="sig-prename descclassname"><span class="pre">fish_3d.cstereo.</span></span><span class="sig-name descname"><span class="pre">match_v3_verbose</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">centres_1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">centres_2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">centres_3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">O1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">O2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">O3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol_2d</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimise</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><span class="pre">bool</span></a></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple[List[Tuple[int,</span> <span class="pre">int,</span> <span class="pre">int,</span> <span class="pre">float]],</span> <span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">3]],</span> <span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">1]]]</span></span></span><a class="headerlink" href="#fish_3d.cstereo.match_v3_verbose" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.cstereo.refractive_project">
<span class="sig-prename descclassname"><span class="pre">fish_3d.cstereo.</span></span><span class="sig-name descname"><span class="pre">refractive_project</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">points</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">3]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">O</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]]</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]</span></span></span><a class="headerlink" href="#fish_3d.cstereo.refractive_project" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.cstereo.refractive_triangulate">
<span class="sig-prename descclassname"><span class="pre">fish_3d.cstereo.</span></span><span class="sig-name descname"><span class="pre">refractive_triangulate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">C1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">P3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">4]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">O1</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">O2</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">O3</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray[numpy.float64[3,</span> <span class="pre">1]]</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">numpy.ndarray[numpy.float64[m,</span> <span class="pre">3]]</span></span></span><a class="headerlink" href="#fish_3d.cstereo.refractive_triangulate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-fish_3d.ctemporal">
<span id="fish-3d-ctemporal-module"></span><h2>fish_3d.ctemporal module<a class="headerlink" href="#module-fish_3d.ctemporal" title="Permalink to this headline">¶</a></h2>
<p>a 2D linking modules</p>
<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ctemporal.get_trajectories">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ctemporal.</span></span><span class="sig-name descname"><span class="pre">get_trajectories</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frames</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List[numpy.ndarray[numpy.float64[m,</span> <span class="pre">2]]]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_range</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">allow_fragment</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.9)"><span class="pre">bool</span></a></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List[List[List[int][2]]]</span></span></span><a class="headerlink" href="#fish_3d.ctemporal.get_trajectories" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-fish_3d.cutility">
<span id="fish-3d-cutility-module"></span><h2>fish_3d.cutility module<a class="headerlink" href="#module-fish_3d.cutility" title="Permalink to this headline">¶</a></h2>
<p>helper functions optimised in cpp</p>
<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.cutility.join_pairs">
<span class="sig-prename descclassname"><span class="pre">fish_3d.cutility.</span></span><span class="sig-name descname"><span class="pre">join_pairs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pairs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#fish_3d.cutility.join_pairs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-fish_3d.ellipse">
<span id="fish-3d-ellipse-module"></span><h2>fish_3d.ellipse module<a class="headerlink" href="#module-fish_3d.ellipse" title="Permalink to this headline">¶</a></h2>
<p>Some helper function I wrote to reconstruct ellipses from three views
This is to calculate the orientation of my fish tank</p>
<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ellipse.cost_conic">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ellipse.</span></span><span class="sig-name descname"><span class="pre">cost_conic</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">RT</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p3dh</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ellipse.cost_conic" title="Permalink to this definition">¶</a></dt>
<dd><p>Cost function to incorporate the conic measurement into camera calibration.
It is aimed to optimise the result of the cv2.solvePnP function.
The conic in the image should correspond to a circle in 3D &#64; plane Z=0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>RT</strong> (<em>np.ndarray</em>) – the rotation and translation to be optimised.            shape (6, )</p></li>
<li><p><strong>K</strong> (<em>np.ndarray</em>) – the intrinsic camera matrix, shape (3, 3)</p></li>
<li><p><strong>C</strong> (<em>np.ndarray</em>) – the matrix for the measured conic, shape (3, 3)</p></li>
<li><p><strong>p2d</strong> (<em>np.ndarray</em>) – 2d features for the solvePnP method, shape (n, 2)</p></li>
<li><p><strong>p3dh</strong> (<em>np.ndarray</em>) – the <em>homogeneous</em> representation of             3d positions for the solvePnP method, shape (n, 4)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the geometric distance</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ellipse.cost_conic_triple">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ellipse.</span></span><span class="sig-name descname"><span class="pre">cost_conic_triple</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">RT123</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2d1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2d2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2d3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p3dh</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ellipse.cost_conic_triple" title="Permalink to this definition">¶</a></dt>
<dd><p>Cost function to incorporate the conic measurement into camera calibration.
It is aimed to optimise the result of the cv2.solvePnP function.
The conic in the image should correspond to a circle in 3D &#64; plane Z=0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>RT123</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the rotation and translation to be optimised,            shape (18,)</p></li>
<li><p><strong>K1</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the calibration matrix            <span class="math notranslate nohighlight">\(\in \mathbb{R}^{3 \times 3}\)</span> of camera 1</p></li>
<li><p><strong>K2</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the calibration matrix            <span class="math notranslate nohighlight">\(\in \mathbb{R}^{3 \times 3}\)</span> of camera 2</p></li>
<li><p><strong>K3</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the calibration matrix            <span class="math notranslate nohighlight">\(\in \mathbb{R}^{3 \times 3}\)</span> of camera 3</p></li>
<li><p><strong>C1</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the conic matrix from camera 1, shape (3, 3)</p></li>
<li><p><strong>C2</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the conic matrix from camera 2, shape (3, 3)</p></li>
<li><p><strong>C3</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the conic matrix from camera 3, shape (3, 3)</p></li>
<li><p><strong>p2d1</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the 2d features for the <cite>solvePnP</cite> method            from camera 1, shape (n, 2)</p></li>
<li><p><strong>p2d2</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the 2d features for the <cite>solvePnP</cite> method            from camera 2, shape (n, 2)</p></li>
<li><p><strong>p2d3</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the 2d features for the <cite>solvePnP</cite> method            from camera 3, shape (n, 2)</p></li>
<li><p><strong>p3dh</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the <em>homogeneous</em> representation of             3d positions for the solvePnP method, shape (n, 4)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the geometric distance</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)">float</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ellipse.draw_ellipse">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ellipse.</span></span><span class="sig-name descname"><span class="pre">draw_ellipse</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">angle</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><span class="pre">numpy.ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">ellipse</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><span class="pre">numpy.ndarray</span></a></span></span><a class="headerlink" href="#fish_3d.ellipse.draw_ellipse" title="Permalink to this definition">¶</a></dt>
<dd><p>return (u, v) coordinates for plotting
no need to use <cite>np.flip</cite> to plot with figure</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ellipse.find_projection">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ellipse.</span></span><span class="sig-name descname"><span class="pre">find_projection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ellipse</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ellipse.find_projection" title="Permalink to this definition">¶</a></dt>
<dd><p>find the point on an ellipse that is closest to a line
:param ellipse: represented as (al, bl, xc, yc, rot), the geometrical form
:param line:    represented as (a1, a2, a3) where l1 x + l2 y + l3 == 0
I am sorry for the inconsistent notations</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ellipse.get_conic_coef">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ellipse.</span></span><span class="sig-name descname"><span class="pre">get_conic_coef</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">yc</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rotation</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ellipse.get_conic_coef" title="Permalink to this definition">¶</a></dt>
<dd><p>Represent an ellipse from geometric form (a, b, x_centre, y_centre, rotation)
to the algebraic form (α x^2 + β x y + γ y^2 + δ x + ε y + η)</p>
<p>The parameters are consistense with the parameters of skimage.measure.EllipseModel</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xc</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – x_centre</p></li>
<li><p><strong>yc</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – y_centre</p></li>
<li><p><strong>a</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – a</p></li>
<li><p><strong>b</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – b</p></li>
<li><p><strong>rotation</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – rotation</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(α, β, γ, δ, ε, η)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ellipse.get_conic_matrix">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ellipse.</span></span><span class="sig-name descname"><span class="pre">get_conic_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">conic_coef</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ellipse.get_conic_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Assemble the conic coefficients into a conic matrix (AQ)</p>
<p>See the <a class="reference external" href="https://en.wikipedia.org/wiki/Matrix_representation_of_conic_sections">wiki page</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>conic_coef</strong> (<em>iterable</em>) – a container with 6 numbers</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the conic matrix</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ellipse.get_geometric_coef">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ellipse.</span></span><span class="sig-name descname"><span class="pre">get_geometric_coef</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matrix</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ellipse.get_geometric_coef" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the geometric coefficients of the conic from a conic Matrix:</p>
<p>$$
\begin{array}{c}
A &amp; B/2 &amp; D/2 \\
B/2 &amp;   C &amp; E/2 \\
D/2 &amp; E/2 &amp;   F
\end{array}
$$</p>
<p>The conic form is written as,</p>
<p>$$
A x^2 + B xy + C y^2 + D x + E y + F = 0
$$</p>
<p>Reference: <a class="reference external" href="https://en.wikipedia.org/wiki/Matrix_representation_of_conic_sections">Wikipedia</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>matrix</strong> (<em>np.ndarray</em>) – the conic matrix, being AQ in the wiki.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(xc, yc, a, b, rotation)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ellipse.get_intersection">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ellipse.</span></span><span class="sig-name descname"><span class="pre">get_intersection</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ellipse</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ellipse.get_intersection" title="Permalink to this definition">¶</a></dt>
<dd><p>Finding the intersection between an ellipse and a line
* If there is no intersection, then find the point on the ellipse that is closest to the line.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ellipse</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>) – represented as (a, b, xc, yc, rot), the geometrical form</p></li>
<li><p><strong>line</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>) – represented as (l1, l2, l3) where l1 x + l2 y + l3 == 0</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ellipse.match_ellipse_sloopy">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ellipse.</span></span><span class="sig-name descname"><span class="pre">match_ellipse_sloopy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cameras</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Camera</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ellipses</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_diff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">250</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_cost</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ellipse.match_ellipse_sloopy" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="w"> </span><span class="n">Randomly</span><span class="w"> </span><span class="nb">choose</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nb">view</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="mf">3.</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">every</span><span class="w"> </span><span class="n">chosen</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="p">(</span><span class="n">P1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mf">1.</span><span class="w"> </span><span class="n">Calculate</span><span class="w"> </span><span class="n">POI</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">P1</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="n">two</span><span class="w"> </span><span class="n">views</span><span class="p">,</span><span class="w"> </span><span class="nb">get</span><span class="w"> </span><span class="n">POI2</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">POI3</span><span class="w"></span>
<span class="w">    </span><span class="mf">2.</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">POI2</span><span class="p">,</span><span class="w"> </span><span class="n">calculate</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">C2</span><span class="p">,</span><span class="w"> </span><span class="nb">get</span><span class="w"> </span><span class="n">P2</span><span class="w"> </span><span class="p">(</span><span class="n">using</span><span class="w"> </span><span class="n">camera</span><span class="o">&#39;</span><span class="n">s</span><span class="w"> </span><span class="n">information</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="mf">3.</span><span class="w"> </span><span class="n">For</span><span class="w"> </span><span class="n">POI3</span><span class="p">,</span><span class="w"> </span><span class="n">calculate</span><span class="w"> </span><span class="n">its</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">C3</span><span class="p">,</span><span class="w"> </span><span class="nb">get</span><span class="w"> </span><span class="n">P3</span><span class="w"></span>
<span class="w">    </span><span class="mf">4.</span><span class="w"> </span><span class="n">Reconstruct</span><span class="w"> </span>3<span class="n">D</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">P1</span><span class="p">,</span><span class="w"> </span><span class="n">P2</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">P3</span><span class="w"></span>
<span class="mf">4.</span><span class="w"> </span><span class="n">These</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="nb">surface</span><span class="w"></span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ellipse.parse_ellipses_imagej">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ellipse.</span></span><span class="sig-name descname"><span class="pre">parse_ellipses_imagej</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">csv_file</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ellipse.parse_ellipses_imagej" title="Permalink to this definition">¶</a></dt>
<dd><p>the ellipse expression corresponds to (u, v) coordinate system</p>
</dd></dl>

</section>
<section id="module-fish_3d.ray_trace">
<span id="fish-3d-ray-trace-module"></span><h2>fish_3d.ray_trace module<a class="headerlink" href="#module-fish_3d.ray_trace" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.cost_snell">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">cost_snell</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">location</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">origin</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refractive_index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.cost_snell" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.epipolar_draw">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">epipolar_draw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">uv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interface</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.33</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.epipolar_draw" title="Permalink to this definition">¶</a></dt>
<dd><p>return all the pixels that contains the epipolar line in image_2, re-projected &amp; distorted</p>
<p>The meanings of variable names can be found in this paper</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>uv</strong> – (u, v) location of a pixel on image from camera_1</p></li>
<li><p><strong>interface</strong> – height of water level in WORLD coordinate system</p></li>
<li><p><strong>normal</strong> – normal of the air-water interface, from water to air</p></li>
<li><p><strong>n</strong> – refractive index of water (or some other media)</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.epipolar_la">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">epipolar_la</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">uv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interface</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.33</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.epipolar_la" title="Permalink to this definition">¶</a></dt>
<dd><p>linear approximation for epipolar line under water
the line path through two UNDISTORTED projection points, one at the interface one below water
use 5 epipolar points under water and do a linear fit</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.epipolar_la_draw">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">epipolar_la_draw</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interface</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.33</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.epipolar_la_draw" title="Permalink to this definition">¶</a></dt>
<dd><p>linear approximation for epipolar line under water
use 3 epipolar points under water and do a linear fit</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.epipolar_refractive">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">epipolar_refractive</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">uv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">interface</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">step</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.33</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.epipolar_refractive" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>The meanings of variable names can be found in this paper</dt><dd><p>10.1109/CRV.2011.26</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>uv</strong> – (u, v) location of a pixel on image from camera_1, NOT (x, y)</p></li>
<li><p><strong>interface</strong> – height of water level in WORLD coordinate system</p></li>
<li><p><strong>normal</strong> – normal of the air-water interface, from water to air</p></li>
<li><p><strong>n</strong> – refractive index of water (or some other media)</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Here the goal is:</dt><dd><ol class="arabic simple">
<li><p>For given pixel (u, v) in image taken by camera #1, calculated
it’s projection on air-water interface (poi_1), and the
direction of the refractted ray (trans_vec)</p></li>
<li><dl class="simple">
<dt>While the projection is still on image from camera_2:</dt><dd><ol class="lowerroman simple">
<li><p>Calculated the position (M) from poi_1 going along trans_vec</p></li>
<li><p>Project M onto camera #2</p></li>
<li><p>Collect the projection points</p></li>
</ol>
</dd>
</dl>
</li>
</ol>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.find_u">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">find_u</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">u</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.find_u" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>The meanings of variable names can be found in this paper</dt><dd><p>10.1109/CRV.2011.26</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.get_intersect_of_lines">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">get_intersect_of_lines</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_intersect_of_lines" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>lines</strong> (<em>np.ndarray</em>) – a collection of different lines, …], shape -&gt; (n, 2, 3)
line = [points (a), unit directions (v)]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.get_intersect_of_lines_slow">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">get_intersect_of_lines_slow</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_intersect_of_lines_slow" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate intersecting point of many lines</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>lines</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – a list containing many lines</p></li>
<li><p><strong>line</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – a dict containing the unit vector and a base point</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the a point in 3D whose distances sum to all lines is minimum</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
<p>(I followed this answer: <a class="reference external" href="https://stackoverflow.com/a/48201730/4116538">https://stackoverflow.com/a/48201730/4116538</a>)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.get_poi">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">get_poi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">camera</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Camera</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">coordinate</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><span class="pre">numpy.ndarray</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_poi" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the poi, point on interface. See the sketch for its meaning</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>               <span class="n">camera</span>
              <span class="o">/</span>
             <span class="o">/</span>
            <span class="o">/</span>
<span class="o">---------</span><span class="p">[</span><span class="n">poi</span><span class="p">]</span><span class="o">--------</span> <span class="n">air</span><span class="o">-</span><span class="n">water</span> <span class="n">interface</span> <span class="p">(</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">)</span>
           <span class="o">|</span>
           <span class="o">|</span>
           <span class="o">|</span>
         <span class="n">fish</span>
</pre></div>
</div>
<p>For the calculation, the equation: P &#64; [x, y, z, 1]’ = [c * v, c * u, c]’ are solved
for x, y, c knowing everything else</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>camera</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – a Camera instance</p></li>
<li><p><strong>z</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – the hight of water level with respect to world origin</p></li>
<li><p><strong>corrdinate</strong> (<em>np.ndarray</em>) – the position (u, v) of object on the image, unit is pixel</p></li>
<li><p><strong>points</strong> (<em>it can be one point</em><em> or </em><em>many</em>) – </p></li>
<li><p><strong>undistorted</strong> (<em>but they should be</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the points on interface, [X, Y, Z], shape (3, n)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.get_poi_cluster">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">get_poi_cluster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">camera</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coordinate</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_poi_cluster" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.get_reproj_err">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">get_reproj_err</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">point_3d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">points_2d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_level</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_reproj_err" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.get_trans_vec">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">get_trans_vec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">incident_vec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refractive_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.33</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_trans_vec" title="Permalink to this definition">¶</a></dt>
<dd><p>get the unit vector of transmitted ray from air to water</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>incident_vec</strong> (<em>np.ndarray</em>) – the vector representing the incident ray</p></li>
<li><p><strong>refractive_index</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – the refractive index of water is 1.33 &#64; 25°C</p></li>
<li><p><strong>normal</strong> (<em>np.ndarray</em>) – the normal vector facing up, the coordinate is looks like</p></li>
</ul>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="o">^</span> <span class="o">+</span><span class="n">z</span>
<span class="n">air</span>     <span class="o">|</span>
        <span class="o">|</span>
<span class="o">------------------&gt;</span>
        <span class="o">|</span>
<span class="n">water</span>   <span class="o">|</span>
        <span class="o">|</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.get_trans_vecs">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">get_trans_vecs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">incident_vecs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refractive_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.33</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_trans_vecs" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the many <em>unit vectors</em> of transmitted rays from air to water</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>incident_vecs</strong> (<em>np.ndarray</em>) – vectors representing many incident rays, shape (n, 3)</p></li>
<li><p><strong>refractive_index</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – the refractive index of water is 1.33 &#64; 25°C</p></li>
<li><p><strong>normal</strong> (<em>np.ndarray</em>) – the normal vector facing up, the coordinate is looks like</p></li>
</ul>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>        <span class="o">^</span> <span class="o">+</span><span class="n">z</span>
<span class="n">air</span>     <span class="o">|</span>
        <span class="o">|</span>
<span class="o">------------------&gt;</span>
        <span class="o">|</span>
<span class="n">water</span>   <span class="o">|</span>
        <span class="o">|</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.get_u">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">get_u</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.get_u" title="Permalink to this definition">¶</a></dt>
<dd><p>n - relative refractive index
d, x, z - length in mm</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.is_inside_image">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">is_inside_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">uv</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.is_inside_image" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.pl_dist">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">pl_dist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">point</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">line</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.pl_dist" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate distance between a point and a line in 3D</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>point</strong> (<em>np.ndarray</em>) – shape (3, )</p></li>
<li><p><strong>line</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – {‘unit’: direction, ‘base’: start_point}</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the distance between a line and a point</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.pl_dist_batch">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">pl_dist_batch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">points</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.pl_dist_batch" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate distance between many points and many lines in 3D</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>points</strong> (<em>np.ndarray</em>) – shape (n, 3,)</p></li>
<li><p><strong>lines</strong> (<em>np.ndarray</em>) – shape (n, view, 2, dim) [dim = 3]</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>many distances, shape (n, )</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.array</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.pl_dist_faster">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">pl_dist_faster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">point</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.pl_dist_faster" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate distance between a point and a line in 3D</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>point</strong> (<em>np.ndarray</em>) – shape (3,)</p></li>
<li><p><strong>line</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><em>dict</em></a>) – {‘unit’: direction, ‘base’: start_point}</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the distance between a line and a point</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.py_get_intersect_of_lines_batch">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">py_get_intersect_of_lines_batch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lines</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.py_get_intersect_of_lines_batch" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>lines</strong> (<em>np.ndarray</em>) – a collection of many matched lines, shape -&gt; (n, view, 2, 3)</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>n points in 3D as the intersect of n * view lines</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.ray_trace_refractive">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">ray_trace_refractive</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">centres</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refractive_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.33</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.ray_trace_refractive" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>centres</strong> – a list of centres (u, v) in different views, they should be undistorted</p></li>
<li><p><strong>cameras</strong> – a list of <em>calibrated</em> Camera objects</p></li>
<li><p><strong>z</strong> – the z-value of the refractive interface</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.ray_trace_refractive_cluster">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">ray_trace_refractive_cluster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">clusters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refractive_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.33</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.ray_trace_refractive_cluster" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.ray_trace_refractive_faster">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">ray_trace_refractive_faster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">centres</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refractive_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.33</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.ray_trace_refractive_faster" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>centres</strong> – a list of centres (u, v) in different views, they should be undistorted</p></li>
<li><p><strong>cameras</strong> – a list of <em>calibrated</em> Camera objects</p></li>
<li><p><strong>z</strong> – the z-value of the refractive interface</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.ray_trace_refractive_trajectory">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">ray_trace_refractive_trajectory</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trajectories</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><span class="pre">numpy.ndarray</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Camera</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refractive_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.33</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.ray_trace_refractive_trajectory" title="Permalink to this definition">¶</a></dt>
<dd><p>reconstruct a trajectory from many views
:param trajectories: list of positions belonging to the same individual at different time points, shape (time_points, dim)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.reproject_refractive">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">reproject_refractive</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xyz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refractive_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.333</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.reproject_refractive" title="Permalink to this definition">¶</a></dt>
<dd><p>variable names follwoing <a class="reference external" href="https://ieeexplore.ieee.org/document/5957554">https://ieeexplore.ieee.org/document/5957554</a>, figure 1</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.reproject_refractive_no_distort">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">reproject_refractive_no_distort</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">xyz</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refractive_index</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.333</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.reproject_refractive_no_distort" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.ray_trace.same_direction">
<span class="sig-prename descclassname"><span class="pre">fish_3d.ray_trace.</span></span><span class="sig-name descname"><span class="pre">same_direction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">v1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">v3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.ray_trace.same_direction" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</section>
<section id="module-fish_3d.stereolink">
<span id="fish-3d-stereolink-module"></span><h2>fish_3d.stereolink module<a class="headerlink" href="#module-fish_3d.stereolink" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.extra_three_view_cluster_match">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">extra_three_view_cluster_match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matched_indices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clusters_multi_view</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol_2d</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">report</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.extra_three_view_cluster_match" title="Permalink to this definition">¶</a></dt>
<dd><p>match clusters tanking simutaneously by three cameras
pretending only features that DID NOT correspond to indices in
<cite>matched_indices</cite> appear in the view
matched_indices: shape (number, view)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.get_fundamental_from_projections">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">get_fundamental_from_projections</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.get_fundamental_from_projections" title="Permalink to this definition">¶</a></dt>
<dd><p>p1: projection matrix of camera for image 1, shape (3, 4)
p2: projection matrix of camera for image 2, shape (3, 4)
F: fundamental matrix, shape (3, 3)
image 1 —&gt; image 2
point_1’ * F * point_2 = 0</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.get_partial_cluster">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">get_partial_cluster</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cluster</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.get_partial_cluster" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.greedy_match">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">greedy_match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">clusters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_level</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol_2d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">report</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">1,</span> <span class="pre">2)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">history</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">array([],</span> <span class="pre">shape=(0,</span> <span class="pre">3),</span> <span class="pre">dtype=float64)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.greedy_match" title="Permalink to this definition">¶</a></dt>
<dd><p>Use greedy algorithm to match clusters across THREE views</p>
<dl class="simple">
<dt>Starting from view_1:</dt><dd><dl class="simple">
<dt>starting from cluster_1:</dt><dd><ol class="arabic simple">
<li><p>find all possible correspondance according to epipolar
relationship in view 2 and view 3</p></li>
<li><p>for all possibility in view 2, validate according to ray-tracing</p></li>
<li><p>for all possibility in view 3, validate according to ray-tracing</p></li>
</ol>
</dd>
</dl>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>clusters</strong> – A collection of points in the 2D image
with the format of (u, v), NOT (x, y)</p></li>
<li><p><strong>cameras</strong> – A collection of Camera instances</p></li>
<li><p><strong>depth</strong> – The maximum depth of water used to constrain
the length of the epipolar relation</p></li>
<li><p><strong>normal</strong> – The direction of the normal of the water.
It should be [0, 0, 1]</p></li>
<li><p><strong>tol_2d</strong> – The tolerance on the distance between epipolar line
and centers, unit is pixel</p></li>
<li><p><strong>points</strong> – the number of points used in 3D stereo matching
for each cluster, choosing randomly</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ol class="arabic simple">
<li><dl class="simple">
<dt>the matched indices across different views;</dt><dd><ol class="arabic simple" start="2">
<li><p>the corresponding 3D centres;</p></li>
<li><p>the corresponding reprojection errors;</p></li>
</ol>
</dd>
</dl>
</li>
</ol>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.join_pairs">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">join_pairs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pairs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.join_pairs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.line2func">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">line2func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.line2func" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.match_clusters">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">match_clusters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">clusters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_level</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.match_clusters" title="Permalink to this definition">¶</a></dt>
<dd><p>return allowed 3d points given matched clusters in different views
the error is the average of perpendicular of 3D points to the three rays,
unit is mm</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.match_points_v3">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">match_points_v3</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cameras</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Camera</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">points</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><span class="pre">numpy.ndarray</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_cost</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.match_points_v3" title="Permalink to this definition">¶</a></dt>
<dd><p>match points in three views
no refractions were considered
:param cameras: a list of three cameras
:param points: (x, y) coordinates in three views</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.multi_view_link">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">multi_view_link</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">c1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.multi_view_link" title="Permalink to this definition">¶</a></dt>
<dd><p>c1: homogenerous centres in image 1, shape (N, 3)
c2: homogenerous centres in image 2, shape (N, 3)
supposing centres in image 1 is in the right order (order of c1)
c2[order] gives the right order of objects in image 2</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.remove_conflict">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">remove_conflict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matched_indices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matched_centres</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reproj_errors</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.remove_conflict" title="Permalink to this definition">¶</a></dt>
<dd><p>Only allow each unique feature, indicated by a number in <cite>matched_indices</cite>,
appear once for each view
That is to say, fish #1 and fish #2 is NOT allowed to the SAME blob
in the same picture.
This means all values in matched_indices.T should be unique along
three views
It works for n views
matched_indices: shape (number, view)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.remove_overlap">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">remove_overlap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">centres</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.remove_overlap" title="Permalink to this definition">¶</a></dt>
<dd><p>centres: possible fish locations, array shape (number, dimension)
errors: reprojection errors of COM of different clouds, shape (number, )
overlap = convex hull overlap; vertices of ch1 goes into ch2</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.three_view_cluster_match">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">three_view_cluster_match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">clusters_multi_view</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol_2d</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">report</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.three_view_cluster_match" title="Permalink to this definition">¶</a></dt>
<dd><p>match clusters tanking simutaneously by three cameras
the clusters were assumed to be in water, n = 1.333</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.three_view_match">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">three_view_match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">features</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol_2d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.three_view_match" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.stereolink.triangulation_v3">
<span class="sig-prename descclassname"><span class="pre">fish_3d.stereolink.</span></span><span class="sig-name descname"><span class="pre">triangulation_v3</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">positions</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><span class="pre">numpy.ndarray</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Camera</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.stereolink.triangulation_v3" title="Permalink to this definition">¶</a></dt>
<dd><p>the positions in different views should be undistorted</p>
</dd></dl>

</section>
<section id="module-fish_3d.utility">
<span id="fish-3d-utility-module"></span><h2>fish_3d.utility module<a class="headerlink" href="#module-fish_3d.utility" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.box_count_polar_image">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">box_count_polar_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">indices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invert</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rawdata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.box_count_polar_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the average density inside different regions inside an image</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<cite>numpy.ndarray</cite>) – the image taken by the camera without undistortion</p></li>
<li><p><strong>indices</strong> (<cite>numpy.ndarray</cite>) – labelled image specifying different box regions</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.box_count_polar_video">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">box_count_polar_video</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">video</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cores</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">report</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">invert</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rawdata</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.box_count_polar_video" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.convert_traj_format">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">convert_traj_format</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">traj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.convert_traj_format" title="Permalink to this definition">¶</a></dt>
<dd><p>Converting from (positions, error) to (time, positions)
The starting &amp; ending NAN will be removed, the NAN in the middile will
be replaced by linear interpolation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>traj</strong> (<cite>tuple</cite>) – one trajectory, represented by (positions, error)</p></li>
<li><p><strong>t0</strong> (<cite>int</cite>) – the starting frame of this trajectory</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>a list of ONE trajectory</dt><dd><p>represented by (time, positions)</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>list</cite> of <cite>tuple</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.draw_fish">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">draw_fish</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">positions</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.draw_fish" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw fish shaped scatter on a matplotlib Axes object</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>positions</strong> (<em>np.ndarray</em>) – positions of the 3D points, shape (n, 3)</p></li>
<li><p><strong>ax</strong> (<em>Axes</em>) – an Axes instance from matplotlib</p></li>
<li><p><strong>size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – the size of the fish</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>None</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.fill_hole_1d">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">fill_hole_1d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">binary</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">size</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.fill_hole_1d" title="Permalink to this definition">¶</a></dt>
<dd><p>Fill “holes” in a binary signal whose length is smaller than size</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>binary</strong> (<cite>numpy.ndarray</cite>) – a boolean numpy array</p></li>
<li><p><strong>size</strong> (<cite>int</cite>) – the holes whose length is smaller than size
will be filled</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the filled binary array</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>numpy.ndarray</cite></p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">binary</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">filled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="n">filled</span><span class="p">,</span> <span class="n">fill_hole_1d</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_ABCD">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_ABCD</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">corners</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">excess_rows</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.9)"><span class="pre">dict</span></a></span></span><a class="headerlink" href="#fish_3d.utility.get_ABCD" title="Permalink to this definition">¶</a></dt>
<dd><p>What is ABCD?</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C +-------+ D
  |       |
  |       |
  |       |
A +-------+ B
</pre></div>
</div>
<p>(AB // CD, AC // BD)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>corners</strong> (<cite>numpy.ndarray</cite>) – the coordinates of chessboard corners found by
<code class="docutils literal notranslate"><span class="pre">cv2.findChessboardCorners</span></code>, shape (n, 2)</p></li>
<li><p><strong>width</strong> (<cite>int</cite>) – the number of corners in a row</p></li>
<li><p><strong>excess_rows</strong> (<cite>int</cite>) – if the chessboard is make of (m, n) corners (m &gt; n)
then n is <em>width</em>, excess_rows = m - n</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the locations of A, B, C, D respectively.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>dict</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_affinity">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_affinity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">abcd</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_affinity" title="Permalink to this definition">¶</a></dt>
<dd><p>Getting the affinity matrix from a set of corners measured from a        chessboard image</p>
<p>what is ABCD?</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C +-------+ D
  |       |
  |       |
  |       |
A +-------+ B
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>abcd</strong> (<cite>dict</cite>) – the measured coordinates of chessboard corners</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the affine transformation</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>numpy.ndarray</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_average_euclidean_transform">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_average_euclidean_transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">Rotations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Translations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_average_euclidean_transform" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the averaged <em>relative</em> rotation and translation from        different noisy measurements. There is an unknown Euclidean        ambiguity between the different measurements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>Rotations</strong> (<em>np.ndarray</em>) – shape (n_measure, n_view, 3, 3)</p></li>
<li><p><strong>Translations</strong> (<em>np.ndarray</em>) – shape (n_measure, n_view, 3)</p></li>
<li><p><strong>index</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – the transforms are bettwen different views            and the view specified by the index</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the relative rotations and translations. The shape of            the elements are ((n_view, 3, 3), (n_view, 3))</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_brcs">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_brcs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">number</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(1.0,</span> <span class="pre">0.7,</span> <span class="pre">0.8)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">brightness</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0.25,</span> <span class="pre">1.0)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_brcs" title="Permalink to this definition">¶</a></dt>
<dd><p>Get biased random colours</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>number</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – the number of random colours.</p></li>
<li><p><strong>bias</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><em>tuple</em></a>) – the bias towards different base colours, in the format
of (r, g, b). The value of r/g/b should range between 0 and 1.</p></li>
<li><p><strong>brightness</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><em>tuple</em></a>) – the brightness in the format of (low, high), the
value of low/high should range from 0 to 1.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the colors, shape (n, 3) or (3) if number==1</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_cameras_with_averaged_euclidean_transform">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_cameras_with_averaged_euclidean_transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_cameras_with_averaged_euclidean_transform" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the extrinsic parameters of the cameras so that the relative        rotation and translation between different views were replace by        the average of different measurements.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cameras</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – a list of cameras, with “shape” (n_measure, n_view).</p></li>
<li><p><strong>index</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><em>int</em></a>) – the transforms are bettwen different views            and the view specified by the index</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a list of cameras whose relative Euclidean transformations were            replaced by the average over different measurements. The “shape”            of the final result is <cite>(n_measure, n_view)</cite>.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)">list</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_clusters">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_clusters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_size</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_clusters" title="Permalink to this definition">¶</a></dt>
<dd><p>apply threshold to image and label disconnected part
small labels (size &lt; min_size) were erased
the coordinates of labels were returned, shape: (label_number, 3)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_corners">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_corners</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rows</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">cols</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_corners" title="Permalink to this definition">¶</a></dt>
<dd><p>use findChessboardCorners in opencv to get coordinates of corners</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_homography">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_homography</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">camera</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">angle_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_homography" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the homography that simiarly recover the 2d image        perpendicular to z-axis</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>camera</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – a Camera instance of current camera</p></li>
<li><p><strong>angle_num</strong> (<cite>int</cite>) – a virtual chessboard is rotated angle_num            times for calculation</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_homography_image">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_homography_image</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rows</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cols</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera_model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_homography_image" title="Permalink to this definition">¶</a></dt>
<dd><p>get the homography transformation from an image with a chess-board</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<cite>numpy.ndarray</cite>) – a 2d image</p></li>
<li><p><strong>rows</strong> (<cite>int</cite>) – the number of <em>internal corners</em> inside each row</p></li>
<li><p><strong>cols</strong> (<cite>int</cite>) – the number of <em>internal corners</em> inside each column</p></li>
<li><p><strong>camera_model</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – (optional) a Camera instance that stores the
distortion coefficients of the lens</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_indices">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_indices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">labels</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_indices" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_optimised_camera_c2c">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_optimised_camera_c2c</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">camera</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conic_mat</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p3d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Nelder-Mead'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_optimised_camera_c2c" title="Permalink to this definition">¶</a></dt>
<dd><p>Optimise the extrinsic parameter of the camera with a known 3D circle.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>camera</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – a calibrated camera, its extrinsic parameters will
be used as the initial guess for the optimisation.</p></li>
<li><p><strong>conic_mat</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the matrix representation of an ellipse.
the parameter should be obtained from an undistorted image.</p></li>
<li><p><strong>p2d</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the <em>undistorted</em> 2d locations for the PnP problem, shape (n, 2)</p></li>
<li><p><strong>p3d</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the 3d locations for the PnP problem, shape (n, 3)</p></li>
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – the name of the optimisation mathod. See scipy doc.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new camera with better extrinsic parameters.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera">Camera</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_optimised_camera_triplet_c2c">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_optimised_camera_triplet_c2c</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conic_matrices</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p3d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Nelder-Mead'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_optimised_camera_triplet_c2c" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Optimise 3 cameras with 2D-3D correspondances as well as a measured</dt><dd><p>conics corresponding to a 3D circle on the plane <span class="math notranslate nohighlight">\(Z=0\)</span>.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cameras</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – three <code class="xref py py-obj docutils literal notranslate"><span class="pre">Camera</span></code> instances</p></li>
<li><p><strong>conic_matrices</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – three conic matrices with shape (3, 3)</p></li>
<li><p><strong>p2ds</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – three <em>distorted</em> 2d locations whose shape is (n, 2)</p></li>
<li><p><strong>p3d</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the 3d locations, shape (n, 3)</p></li>
<li><p><strong>method</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.9)"><em>str</em></a>) – the method for the non-lienar optimisation</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>three cameras whose extrinsic parameters were optimised</dt><dd><p>with the circle-to-conic correspondances.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)">list</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_orient_line">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_orient_line</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">locations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">orientations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_orient_line" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the line for plot the orientations</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>locations</strong> (<cite>numpy.ndarray</cite>) – shape (n, 2)</p></li>
<li><p><strong>orientations</strong> (<cite>numpy.ndarray</cite>) – shape (n, )</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_overlap_pairs">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_overlap_pairs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trajs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rtol</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_overlap_pairs" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trajs</strong> (<cite>list</cite>) – a collections of trajectories, each trajectory is
a tuple, containing (positions [N, 3], reprojection_error)</p></li>
<li><p><strong>num</strong> (<cite>int</cite>) – the maximum number of allowed overlapped objects</p></li>
<li><p><strong>rtol</strong> (<cite>float</cite>) – the minimum distance between two non-overlapped objects</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the indices of overlapped objects</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>list</cite> of <cite>tuple</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_polar_chop_spatial">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_polar_chop_spatial</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">radius</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_angle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_radius</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_polar_chop_spatial" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Retrieve the correspondance between the values from <a class="reference internal" href="#fish_3d.utility.polar_chop" title="fish_3d.utility.polar_chop"><code class="xref any py py-func docutils literal notranslate"><span class="pre">polar_chop</span></code></a></dt><dd><p>and the radius/angle values.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>radius</strong> (<cite>int</cite>) – maximum radius in the polar coordinate system</p></li>
<li><p><strong>n_angle</strong> (<cite>int</cite>) – number of bins in terms of angle</p></li>
<li><p><strong>n_radius</strong> (<cite>int</cite>) – number of bins in terms of radius</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>{ label_value : (angle, radius), … }</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>dict</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_short_trajs">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_short_trajs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">features_mv_mt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">st_error_tol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_range</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z_min</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z_max</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overlap_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overlap_rtol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reproj_err_tol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t3</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_short_trajs" title="Permalink to this definition">¶</a></dt>
<dd><p>Getting short 3D trajectories from 2D positions and camera informations</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cameras</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – cameras for 3 views</p></li>
<li><p><strong>freatrues_mv_mt</strong> (<cite>list</cite>) – 2d features in different views            at different frames</p></li>
<li><p><strong>st_error_tol</strong> (<cite>float</cite>) – the stereo reprojection error cut-off            for stereo linking</p></li>
<li><p><strong>tau</strong> (<cite>int</cite>) – the length of trajectories in each batch; unit: frame
the overlap between different batches will be <cite>tau // 2</cite></p></li>
<li><p><strong>z_min</strong> (<cite>float</cite>) – the minimum allowed z-values for all trajectories</p></li>
<li><p><strong>z_max</strong> (<cite>float</cite>) – the maximum allowed z-values for all trajectories</p></li>
<li><p><strong>t1</strong> (<cite>int</cite>) – the time duration in the first iteration in GReTA</p></li>
<li><p><strong>t2</strong> (<cite>int</cite>) – the time duration in the second iteration in GReTA</p></li>
<li><p><strong>t3</strong> (<cite>int</cite>) – the time duration in the third iteration in GReTA</p></li>
<li><p><strong>overlap_num</strong> (<cite>int</cite>) – if two trajectories have more numbers of
overlapped positions than <cite>overlap_num</cite>, establish a link.</p></li>
<li><p><strong>overlap_rtol</strong> (<cite>float</cite>) – if two trajectories have more numbers of
overlapped positions, link them.</p></li>
<li><p><strong>reproj_err_tol</strong> (<cite>float</cite>) – the 3d positiosn whose reprojection error
is greater than this will not be re-constructed, instead a NAN
is inserted into the trajectory</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>trajectories</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>list</cite> [ (<cite>numpy.ndarray</cite>, <cite>float</cite>) ]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_similarity">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_similarity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">abcd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H_aff</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_similarity" title="Permalink to this definition">¶</a></dt>
<dd><p>Getting the similarity matrix from a set of corners measured from</p>
<p>What is ABCD?</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C +-------+ D
  |       |
  |       |
  |       |
A +-------+ B
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>abcd</strong> (<cite>dict</cite>) – the measured coordinates of chessboard corners</p></li>
<li><p><strong>H_aff</strong> (<cite>numpy.ndarray</cite>) – affinity that makes coordinates affinely            recitified</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the similar transformation matrix</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>numpy.ndarray</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_temporal_overlapped_pairs">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_temporal_overlapped_pairs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch_1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ntol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rtol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unique</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'conn'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_temporal_overlapped_pairs" title="Permalink to this definition">¶</a></dt>
<dd><p>Get pairs that link overlapped trajectories from two batches.
The temporal size of trajectories in both batches should be the same.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch_1</strong> – (<cite>list</cite> [ ( <cite>numpy.ndarray</cite>, <cite>float</cite> ) ]):            each trajectory is (positions, error), time is <cite>[t0, t0 + size]</cite></p></li>
<li><p><strong>batch_2</strong> – (<cite>list</cite> [ ( <cite>numpy.ndarray</cite>, <cite>float</cite> ) ]):            each trajectory is (positions, error), time is            <cite>[t0 + lag, t0 + size + lag]</cite></p></li>
<li><p><strong>lag</strong> (<cite>int</cite>) – The temporal lag between two batches</p></li>
<li><p><strong>ntol</strong> (<cite>int</cite>) – if two trajectories have more numbers of            overlapped positions than <cite>ntol</cite>, establish a link</p></li>
<li><p><strong>rtol</strong> (<cite>float</cite>) – positions whose distance is smaller than <cite>rtol</cite>            are considered to be overlapped.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>indices of a pair of overlapped trajectories,            shape (n, 2)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>numpy.ndarray</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_trajectory_batches">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_trajectory_batches</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">features_mv_mt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">st_error_tol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">search_range</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z_min</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z_max</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overlap_num</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">overlap_rtol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reproj_err_tol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_trajectory_batches" title="Permalink to this definition">¶</a></dt>
<dd><p>Getting short 3D trajectories batches from 2D positions and camera informations
A batch is trajectories start from <cite>t0</cite> to <cite>t0 + tau</cite>
It is designed so that the same object will overlap in different batches, and
they can be joined with function <a class="reference internal" href="#fish_3d.utility.resolve_temporal_overlap" title="fish_3d.utility.resolve_temporal_overlap"><code class="xref any py py-func docutils literal notranslate"><span class="pre">resolve_temporal_overlap</span></code></a></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>───────────▶              (trajectory in batch 1)
      ───────────▶        (trajectory in batch 2)
            ───────────▶  (trajectory in batch 3)
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cameras</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – cameras for 3 views</p></li>
<li><p><strong>freatrues_mv_mt</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a>) – 2d features in different views at different frames</p></li>
<li><p><strong>st_error_tol</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>) – the stereo reprojection error cut-off for stereo linking</p></li>
<li><p><strong>tau</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>) – the length of trajectories in each batch; unit: frame
the overlap between different batches will be <cite>tau // 2</cite></p></li>
<li><p><strong>z_min</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>) – the minimum allowed z-positions for all trajectories</p></li>
<li><p><strong>z_max</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>) – the maximum allowed z-positions for all trajectories</p></li>
<li><p><strong>overlap_num</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">int</span></code></a>) – if two trajectories have more numbers of
overlapped positions than <cite>overlap_num</cite>, establish a link.</p></li>
<li><p><strong>overlap_rtol</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>) – if two trajectories have more numbers of
overlapped positions, link them.</p></li>
<li><p><strong>reproj_err_tol</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>) – the 3d positiosn whose reprojection error
is greater than this will not be re-constructed, instead a NAN
is inserted into the trajectory</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>trajectories in different batches</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a> [ <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">list</span></code></a> [ (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">float</span></code></a>) ] ]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_updated_camera">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_updated_camera</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">camera</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_updated_camera" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the updated camera with new rotation and translation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>R</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the new rotation vector <span class="math notranslate nohighlight">\(\in so(3)\)</span></p></li>
<li><p><strong>T</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the new translation vector            <span class="math notranslate nohighlight">\(\in \mathbb{R}^3\)</span></p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a new <cite>Camera</cite> instance whose extrinsic parameters            were updated.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera">Camera</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.get_valid_ctraj">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">get_valid_ctraj</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trajectories</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z_min</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z_max</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.get_valid_ctraj" title="Permalink to this definition">¶</a></dt>
<dd><p>Extract valid trajectories (inside box boundary) from raw trajectories</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trajectories</strong> (<cite>list</cite> [ ( <cite>numpy.ndarray</cite>, <cite>float</cite> ) ]) – a collection of trajectories, each trajectory is (positions , error)</p></li>
<li><p><strong>z_min</strong> (<cite>float</cite>) – the minimum allowed z-coordinate of each trajectory            corresponding to the bottom of the boundary.</p></li>
<li><p><strong>z_max</strong> (<cite>float</cite>) – the maximum allowed z-coordinate of each trajectory            corresponding to the top of the boundary.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>valid trajectories</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>list</cite> [ ( <cite>numpy.ndarray</cite>, <cite>float</cite> ) ]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.interpolate_nan">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">interpolate_nan</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coordinates</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.interpolate_nan" title="Permalink to this definition">¶</a></dt>
<dd><p>replace nan with linear interpolation of a (n, 3) array along the first axis</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coordinates</strong> (<cite>numpy.ndarray</cite>) – xyz coordinates of a trajectory,            might contain nan</p></li>
<li><p><strong>is_nan</strong> (<cite>numpy.ndarray</cite>) – 1d bolean array showing if coordinates[i]            is nan or not</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the interpolated coordinates array</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>numpy.ndarray</cite></p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">target</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(100, 3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">with_nan</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nan_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">with_nan</span><span class="p">[</span><span class="n">nan_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">with_nan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">with_nan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">interpolate_nan</span><span class="p">(</span><span class="n">with_nan</span><span class="p">))</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.optimise_c2c">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">optimise_c2c</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p3dh</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Nelder-Mead'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.optimise_c2c" title="Permalink to this definition">¶</a></dt>
<dd><p>Optimise the camera extrinsic parameters by measuring the ellipse (conic)    projected by a circle at plane <span class="math notranslate nohighlight">\(\pi_z = (0, 0, 1, 0)^T\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>R</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the rotation vector <span class="math notranslate nohighlight">\(\in so(3)\)</span></p></li>
<li><p><strong>T</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the translation vector <span class="math notranslate nohighlight">\(\in \mathbb{R}^3\)</span></p></li>
<li><p><strong>K</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the calibration matrix
<span class="math notranslate nohighlight">\(\in \mathbb{R}^{3 \times 3}\)</span></p></li>
<li><p><strong>C</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the matrix representation of a conic,
shape (3, 3). The conic is a projection of the circle.</p></li>
<li><p><strong>p2d</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the <em>undistorted</em> 2d points for the PnP problem,            shape (n, 2)</p></li>
<li><p><strong>p3dh</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the homogeneous representations of 3d points            for the PnP problem, shape (n, 3)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the optimised <span class="math notranslate nohighlight">\(\mathbf{R} \in so(3)\)</span> and        <span class="math notranslate nohighlight">\(\mathbf{T} \in \mathbb{R}^3\)</span></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.optimise_triplet_c2c">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">optimise_triplet_c2c</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">R1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">R2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">R3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">T3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">C3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2d1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2d2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p2d3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p3dh</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.optimise_triplet_c2c" title="Permalink to this definition">¶</a></dt>
<dd><p>Optimise three camera extrinsic parameters by measuring the ellipse (conic)    projected by a circle at plane <span class="math notranslate nohighlight">\(\pi_z = (0, 0, 1, 0)^T\)</span>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>R1</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the rotation vector <span class="math notranslate nohighlight">\(\in so(3)\)</span> of camera 1</p></li>
<li><p><strong>T1</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the translation vector <span class="math notranslate nohighlight">\(\in \mathbb{R}^3\)</span>            of camera 1</p></li>
<li><p><strong>R2</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the rotation vector <span class="math notranslate nohighlight">\(\in so(3)\)</span> of camera 2</p></li>
<li><p><strong>T2</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the translation vector <span class="math notranslate nohighlight">\(\in \mathbb{R}^3\)</span>            of camera 2</p></li>
<li><p><strong>R3</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the rotation vector <span class="math notranslate nohighlight">\(\in so(3)\)</span> of camera 3</p></li>
<li><p><strong>T3</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the translation vector <span class="math notranslate nohighlight">\(\in \mathbb{R}^3\)</span>            of camera 3</p></li>
<li><p><strong>K1</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the calibration matrix            <span class="math notranslate nohighlight">\(\in \mathbb{R}^{3 \times 3}\)</span> of camera 1</p></li>
<li><p><strong>K2</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the calibration matrix            <span class="math notranslate nohighlight">\(\in \mathbb{R}^{3 \times 3}\)</span> of camera 2</p></li>
<li><p><strong>K3</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the calibration matrix            <span class="math notranslate nohighlight">\(\in \mathbb{R}^{3 \times 3}\)</span> of camera 3</p></li>
<li><p><strong>C1</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the conic matrix from camera 1, shape (3, 3)</p></li>
<li><p><strong>C2</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the conic matrix from camera 2, shape (3, 3)</p></li>
<li><p><strong>C3</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the conic matrix from camera 3, shape (3, 3)</p></li>
<li><p><strong>p2d1</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the <em>undistorted</em> 2d features for the PnP            problem from camera 1, shape (n, 2)</p></li>
<li><p><strong>p2d2</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the <em>undistorted</em> 2d features for the PnP            problem from camera 2, shape (n, 2)</p></li>
<li><p><strong>p2d3</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the <em>undistorted</em> 2d features for the PnP            problem from camera 3, shape (n, 2)</p></li>
<li><p><strong>p3dh</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – the homogeneous representations of 3d points            for the PnP problem, shape (n, 3)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the optimised <span class="math notranslate nohighlight">\(\mathbf{R} \in so(3)\)</span> and        <span class="math notranslate nohighlight">\(\mathbf{T} \in \mathbb{R}^3\)</span></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.plot_cameras">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">plot_cameras</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">depth</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">400</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.plot_cameras" title="Permalink to this definition">¶</a></dt>
<dd><p>Draw cameras on the matplotlib Axes instance with water.</p>
<p>This is typically designed to represent the experiment in my PhD.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ax</strong> (<em>Axes</em>) – an Axes instance from matplotlib</p></li>
<li><p><strong>cameras</strong> (<a class="reference internal" href="#fish_3d.camera.Camera" title="fish_3d.camera.Camera"><em>Camera</em></a>) – the instance of Camera class</p></li>
<li><p><strong>water_level</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – the water level in the world coordinate</p></li>
<li><p><strong>depth</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – the depth of the water</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the axes with the cameras</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Axes</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.plot_epl">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">plot_epl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><span class="pre">float</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><span class="pre">numpy.ndarray</span></a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.plot_epl" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the scatters of an epipolar line <em>inside</em> an image
The images is considered as being stored in (row [y], column [x])</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.plot_reproject">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">plot_reproject</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">features</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pos_3d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.plot_reproject" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>pos_3d</strong> (<em>np.ndarray</em>) – 3d positions, shape (n, 3)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.plot_reproject_with_roi">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">plot_reproject_with_roi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roi</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">features</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pos_3d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">camera</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">water_level</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(0,</span> <span class="pre">0,</span> <span class="pre">1)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.plot_reproject_with_roi" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.polar_chop">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">polar_chop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H_sim</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">centre</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radius</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_angle</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_radius</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dist_coef</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.polar_chop" title="Permalink to this definition">¶</a></dt>
<dd><p>Chop an image in the polar coordinates
return the chopped result as a labelled image</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<cite>numpy.ndarray</cite>) – 2d image as a numpy array</p></li>
<li><p><strong>H_sim</strong> (<cite>numpy.ndarray</cite>) – a homography (3 x 3 matrix) to similarly            rectify the image</p></li>
<li><p><strong>centre</strong> (<cite>numpy.ndarray</cite>) – origin of the polar coordinate system</p></li>
<li><p><strong>radius</strong> (<cite>int</cite>) – maximum radius in the polar coordinate system</p></li>
<li><p><strong>n_angle</strong> (<cite>int</cite>) – number of bins in terms of angle</p></li>
<li><p><strong>n_radius</strong> (<cite>int</cite>) – number of bins in terms of radius</p></li>
<li><p><strong>dist_coef</strong> (<cite>numpy.ndarray</cite>) – distortion coefficients of the camera            , shape (5, ), k1, k2, p1, p2, k3 (from opencv by default)</p></li>
<li><p><strong>k</strong> – (<cite>numpy.ndarray</cite>) camera calibration matrix (bible, P155)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>labelled image where each chopped regions were labelled            with different values</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>numpy.array</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.post_process_ctraj">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">post_process_ctraj</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trajs_3d</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">t0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z_min</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z_max</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rtol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.post_process_ctraj" title="Permalink to this definition">¶</a></dt>
<dd><p>Refining the trajectories obtained from cgreta, following three steps</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Removing trajectories that is outside the boundary (fish tank).</p></li>
<li><p>Removing trajectories that overlaps. Overlapping means for           2 trajectories, there are more than <code class="xref py py-data docutils literal notranslate"><span class="pre">num</span></code> positions           whose distance is below <code class="xref py py-data docutils literal notranslate"><span class="pre">rtol</span></code></p></li>
<li><p>Convert the format of the trajectory, from (position, error)           to (time, position)</p></li>
</ol>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trajs_3d</strong> (<cite>list</cite> [ ( <cite>numpy.ndarray</cite>, <cite>float</cite> ) ]) – a collection of trajectories, each trajectory is (positions , error)</p></li>
<li><p><strong>t0</strong> (<cite>int</cite>) – the starting frame of these trajectories.</p></li>
<li><p><strong>z_min</strong> (<cite>float</cite>) – the minimum allowed z-coordinate of each trajectory            corresponding to the bottom of the boundary.</p></li>
<li><p><strong>z_max</strong> (<cite>float</cite>) – the maximum allowed z-coordinate of each trajectory            corresponding to the top of the boundary.</p></li>
<li><p><strong>num</strong> (<cite>int</cite>) – the maximum number of allowed overlapped positions.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a collection of refined trajectories, represented as (time, position)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>list</cite> [ (<cite>numpy.ndarray</cite>, <cite>numpy.ndarray</cite>) ]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.refine_trajectory">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">refine_trajectory</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trajectory</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cameras</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">features</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol_2d</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.refine_trajectory" title="Permalink to this definition">¶</a></dt>
<dd><dl class="simple">
<dt>Refine the trajectory so that each reprojected position</dt><dd><p>matches the features detected in different cameras.</p>
</dd>
<dt>The purpose of the function is to optimise the linearly</dt><dd><p>interpolated trajectories.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trajectory</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)"><em>numpy.ndarray</em></a>) – a fully interpolated trajectory,
shape (n_frame, 3).</p></li>
<li><p><strong>cameras</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – a collections of cameras.</p></li>
<li><p><strong>features</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.9)"><em>list</em></a>) – the positions of 2D features from
different cameras, shape of element: (n_frame, 2).</p></li>
<li><p><strong>tol_2d</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – the tolerance for 2D reprojection errors.
The very problematic 3D points will be replaced by the
origional points in the <cite>trajectory</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>a optimised trajectory, where 3D locations</dt><dd><p>are re-calculated from the 2D features.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.21)">numpy.ndarray</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.remove_spatial_overlap">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">remove_spatial_overlap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trajectories</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ntol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rtol</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.remove_spatial_overlap" title="Permalink to this definition">¶</a></dt>
<dd><p>If two trajectories were overlap in the space, choose the one        with minimum reprojection error.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trajectories</strong> (<cite>list</cite> of (<cite>numpy.ndarray</cite>, <cite>float</cite>)) – a collection            of trajectories, each trajectory is (positions, reprojection_error)</p></li>
<li><p><strong>ntol</strong> (<cite>int</cite>) – if two trajectories have more numbers of overlapped            positions than <cite>ntol</cite>, establish a link.</p></li>
<li><p><strong>rtol</strong> (<cite>float</cite>) – if two trajectories have more numbers of overlapped            positions, choose the one with smaller reprojection error.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>trajectories without            spatial overlap</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>list</cite> of (<cite>numpy.ndarray</cite>, <cite>float</cite>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.resolve_temporal_overlap">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">resolve_temporal_overlap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">trajectory_batches</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lag</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ntol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rtol</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.resolve_temporal_overlap" title="Permalink to this definition">¶</a></dt>
<dd><p>For trajectorie in many batches, extend them if they were overlapped.</p>
<p>For instance</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>INPUT:
         | lag |
    ───────────▶              (trajectory in batch 1)
          ───────────▶        (trajectory in batch 2)
                ───────────▶  (trajectory in batch 3)
OUTPUT:
    ───────────────────────▶  (trajectory in result)
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>trajectory_batches</strong> – (<cite>list</cite> [ <cite>list</cite> [ (<cite>numpy.ndarray</cite>, <cite>float</cite>) ] ]):
trajectories in different batches</p></li>
<li><p><strong>lag</strong> (<cite>int</cite>) – the overlapped time between trajectories in two            successive batches.  TODO: fix the bug when lag is odd number</p></li>
<li><p><strong>ntol</strong> (<cite>int</cite>) – if two trajectories have more numbers of            overlapped positions than <cite>ntol</cite>, merge the two.</p></li>
<li><p><strong>rtol</strong> (<cite>float</cite>) – positions whose distance is smaller than <cite>rtol</cite>            are considered to be overlapped.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a collection of resolved            trajectories</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>list</cite> [ (<cite>numpy.ndarray</cite>, <cite>float</cite>) ]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.see_corners">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">see_corners</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">corner_number</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">(23,</span> <span class="pre">15)</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.see_corners" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.solve_overlap_lp">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">solve_overlap_lp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">points</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">errors</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">diameter</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.solve_overlap_lp" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove overlapped particles using linear programming, following</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>minimize the total error</p></li>
<li><p>particles do not overlap</p></li>
<li><p>retain most particles</p></li>
</ol>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>points</strong> (<em>np.ndaray</em>) – particle locations, shape (N, dimension)</p></li>
<li><p><strong>errors</strong> (<em>np.ndarray</em>) – the error (cost) of each particle, shape (N, )</p></li>
<li><p><strong>diameter</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.9)"><em>float</em></a>) – the minimium distance between non-overlap particles</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the optimised positions, shape (N’, dimension)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>np.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="fish_3d.utility.update_orientation">
<span class="sig-prename descclassname"><span class="pre">fish_3d.utility.</span></span><span class="sig-name descname"><span class="pre">update_orientation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">orientations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">locations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">H</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">length</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#fish_3d.utility.update_orientation" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the orientatin after applying homography H
This is function is used to get a ‘recitified’ orientation</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>orientation</strong> (<cite>numpy.ndarray</cite>) – angles of the fish,            sin(angle) -&gt; x very sadly</p></li>
<li><p><strong>locatons</strong> (<cite>numpy.ndarray</cite>) – xy positons of fish in            the image, not row-col</p></li>
<li><p><strong>H</strong> (<cite>numpy.ndarray</cite>) – the homography matrix</p></li>
<li><p><strong>length</strong> (<cite>int</cite>) – length of the orientation bar</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the recitified orientations</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>numpy.ndarray</cite></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-fish_3d">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-fish_3d" title="Permalink to this headline">¶</a></h2>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="modules.html">FishPy Modules</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="fish_corr.html">fish_corr package</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Yushi Yang.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.1.2.
    </div>
  </body>
</html>