
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Miscellaneous Topics &#8212; FishPy  documentation</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="FishPy Modules" href="modules.html" />
    <link rel="prev" title="Tracking in nD: Linking" href="link.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>FishPy  documentation</span></a></h1>
        <h2 class="heading"><span>Miscellaneous Topics</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="link.html">Tracking in nD: Linking</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="modules.html">FishPy Modules</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <div class="section" id="miscellaneous-topics">
<h1>Miscellaneous Topics<a class="headerlink" href="#miscellaneous-topics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="preprocess-videos">
<h2>Preprocess videos<a class="headerlink" href="#preprocess-videos" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="analysing-results">
<h2>Analysing results<a class="headerlink" href="#analysing-results" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="gui-applications">
<h2>GUI applications<a class="headerlink" href="#gui-applications" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="working-with-hpc">
<h2>Working with HPC<a class="headerlink" href="#working-with-hpc" title="Permalink to this headline">¶</a></h2>
<p>This section introduce how I use <cite>FishPy</cite> on the supercomputer, typically the “BlueCrystal” in the university of Bristol to extract 3D trajectories from videos.</p>
<div class="section" id="organise-the-experimental-results">
<h3>Organise the Experimental Results<a class="headerlink" href="#organise-the-experimental-results" title="Permalink to this headline">¶</a></h3>
<p>we need some auxiliary files for the tracking. And I organise my files like the follows. Here all the data is stored in a folder named <cite>observe_20190729_fish_20_small</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>observe_20190729_fish_20_small/
├── arduino
│   ├── arduino.ino (arduino script for generating camera signals)
│   └── build (the folder generated by the arduino IDE)
│
├── calib_ext (folder for images to get extrinsic camera parameters)
│   ├── cam-1-1.tiff
│   ├── cam-2-1.tiff
│   ├── cam-3-1.tiff
│   ├── cam-1-2.tiff
│   ├── cam-2-2.tiff
│   ├── cam-3-2.tiff
│   └── ...
│
├── calib_int (folder for images to get intrinsic camera parameters)
│   ├── cam-1-1.tiff
│   ├── cam-2-1.tiff
│   ├── cam-3-1.tiff
│   ├── cam-1-2.tiff
│   ├── cam-2-2.tiff
│   ├── cam-3-2.tiff
│   └── ...
│
├── video_1
│   ├── cam-1.mp4
│   ├── cam-2.mp4
│   ├── cam-3.mp4
│   └── readme.md (notes about the experimental condition)
│
└── video_2
    ├── cam-1.mp4
    ├── cam-2.mp4
    ├── cam-3.mp4
    └── readme.md (notes about the experimental condition)
</pre></div>
</div>
</div>
<div class="section" id="upload-the-folder-to-the-hpc">
<h3>Upload the folder to the HPC<a class="headerlink" href="#upload-the-folder-to-the-hpc" title="Permalink to this headline">¶</a></h3>
<p>I use the following command to upload my folder to the HPC.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>scp -r observe_20190729_fish_20_small ab12345@bluecrystalp3.bris.ac.uk:~/fish_data
</pre></div>
</div>
</div>
<div class="section" id="start-the-project">
<h3>Start the project<a class="headerlink" href="#start-the-project" title="Permalink to this headline">¶</a></h3>
<p>I wrote a lot of helper scripts for setting up the tracking projects. They are stored in the folder <cite>Fishpy/script/bin</cite>. I added this folder to my <cite>$HOME</cite> variable to use these script convinently. For starting a new tracking project, I would typically use the following command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>fishpy-create-project
</pre></div>
</div>
<p>what this command would do is copying the folder <cite>Fishpy/script/auto_process_*</cite> to our project folder. Typically, the script will scan through the current folders and find those whose names are started with <cite>video</cite>.</p>
<p>Typically, we have the following two folders</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>video-1
video-2
</pre></div>
</div>
<p>Therefor, the command will generate the two following new folders.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>auto_process_1
auto_process_2
</pre></div>
</div>
<p>(running the <cite>fishpy-create-project</cite> again will not overwrite the existing folders.)</p>
</div>
<div class="section" id="configuring-the-project">
<h3>Configuring the Project<a class="headerlink" href="#configuring-the-project" title="Permalink to this headline">¶</a></h3>
<p>To get the trajectories from <cite>video_1</cite>, we have to make several changes in the folder <cite>auto_process_1</cite>.</p>
<p>In the file <cite>configure.sh</cite> should be modified. Here is an example. There are horribly lot of parameters. But the important ones will be highlighted.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="c1"># Specifying files</span>
<span class="nv">script_folder</span><span class="o">=</span><span class="s2">&quot;script&quot;</span>
<span class="nv">video_folder</span><span class="o">=</span><span class="s2">&quot;../video_1&quot;</span> <span class="c1"># &lt;&lt;&lt;&lt; This must match the folder that holds videos</span>
<span class="nv">cam_1_internal</span><span class="o">=</span><span class="s2">&quot;database/cam_1_int.pkl&quot;</span>  <span class="c1"># &lt;&lt;&lt;&lt; The intrinsic camera parameters</span>
<span class="nv">cam_2_internal</span><span class="o">=</span><span class="s2">&quot;database/cam_2_int.pkl&quot;</span>
<span class="nv">cam_3_internal</span><span class="o">=</span><span class="s2">&quot;database/cam_3_int.pkl&quot;</span>

<span class="c1"># Calibration Spec</span>
<span class="nv">calib_folder</span><span class="o">=</span><span class="s2">&quot;../calib-ext&quot;</span>
<span class="nv">calib_format</span><span class="o">=</span><span class="s2">&quot;tiff&quot;</span>
<span class="nv">order_json</span><span class="o">=</span><span class="s2">&quot;../calib-ext/calib-orders.json&quot;</span>
<span class="nv">grid_size</span><span class="o">=</span><span class="m">16</span>   <span class="c1"># &lt;&lt;&lt;&lt; The size of square on the calibration board, unit: mm</span>
<span class="nv">corner_number</span><span class="o">=</span><span class="s2">&quot;23, 15&quot;</span>  <span class="c1"># &lt;&lt;&lt;&lt; The number of inner corners in the row, column</span>

<span class="c1"># ... the rest of the file is ignored</span>
</pre></div>
</div>
</div>
<div class="section" id="executing-the-tracking">
<h3>Executing the Tracking<a class="headerlink" href="#executing-the-tracking" title="Permalink to this headline">¶</a></h3>
<p>If the configuration is good, I track the fish with the following three commands. On an hpc, I would typically submit these three jobs.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>qsub auto_track_2d.sh
qsub auto_track_3d.sh
qsub auto_link.sh
</pre></div>
</div>
<p>I also implemented another tracking algoritm called [GReTA](<a class="reference external" href="http://ieeexplore.ieee.org/document/7062911/">http://ieeexplore.ieee.org/document/7062911/</a>). The workflow for GReTA is,</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>qsub auto_track_2d.sh
qsub auto_track_greta.sh
</pre></div>
</div>
</div>
<div class="section" id="see-the-result">
<h3>See the Result<a class="headerlink" href="#see-the-result" title="Permalink to this headline">¶</a></h3>
<p>If you get very lucky and obtained the final result, you can use the following command to visualise the 3D trajectories.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python see_trajs.py linking   <span class="c1"># if not using GReTA</span>
python see_trajs.py greta     <span class="c1"># if using GReTA</span>
</pre></div>
</div>
<p>this command would generate a file callend <cite>trajs.png</cite>. You can see the image with this command.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>display trajs.png
</pre></div>
</div>
<p>Similarly, I wrote a script to conveniently see the distribution of the trajectories lengths. Typically I would use the folloing command.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>python stat_trajs.py linking   <span class="c1"># if not using GReTA</span>
python stat_trajs.py greta     <span class="c1"># if using GReTA</span>
display traj-stat.png
</pre></div>
</div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="link.html">Tracking in nD: Linking</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="modules.html">FishPy Modules</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Yushi Yang.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>